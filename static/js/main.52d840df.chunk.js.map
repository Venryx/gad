{"version":3,"sources":["images/gad-logo-small-white.png","assets/gad-title.png","subrepos/dm-server/Source/@Shared/Store/firebase/users_private/@User_Private.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodeRevisions/@SourceChain.ts","components/TopNav.tsx","components/PageEffects.tsx","pages/Welcome.tsx","components/TitleBlock.tsx","components/ExploreScore.tsx","components/Topic.tsx","pages/Debates.tsx","subrepos/dm-server/Source/@Shared/Store/firebase/nodeRevisions.ts","subrepos/dm-server/Source/@Shared/Store/firebase/images.ts","subrepos/dm-server/Source/@Shared/Store/firebase/images/@Image.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodes/@MapNodeType.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodes/@MapNode.ts","subrepos/dm-server/Source/@Shared/Store/firebase/maps/@Map.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodes/@MapNodeRevision.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodeTags/@MapNodeTag.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodeTags.ts","subrepos/dm-server/Source/@Shared/Store/firebase/maps.ts","subrepos/dm-server/Source/@Shared/MobXFirelink.ts","subrepos/dm-server/Source/@Shared/Store/firebase.ts","subrepos/dm-server/Source/@Shared/Store/firebase/users.ts","subrepos/dm-server/Source/@Shared/Store/firebase/users/$user.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodes/$node.ts","subrepos/dm-server/Source/@Shared/Store/firebase/nodes.ts","firestore/firestore.ts","pages/Questions.tsx","components/Position.tsx","pages/Positions.tsx","components/Reason.tsx","pages/Reasons.tsx","pages/Argument.tsx","pages/Claim.tsx","subrepos/init-dm-server.ts","App.tsx","index.ts"],"names":["module","exports","__webpack_require__","p","User_Private","Object","C_Root_Apps_V_GAD_Client_Fork_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_key","email","providerData","backgroundID","backgroundCustom_enabled","backgroundCustom_color","backgroundCustom_url","backgroundCustom_position","AddSchema","properties","type","SourceType","TopNav","props","_React$useState","React","_React$useState2","slicedToArray","showMenu","setShowMenu","toggleMenu","e","react","className","react_router_dom","to","src","logo","alt","onClick","classNames","hidden","PageEffects","animation","duration","options","keyframes","fadeOut","opacity","timingOptions","once","iterations","fill","linkClickHandler","preventDefault","document","getElementsByClassName","animate","window","setTimeout","location","target","closest","href","requestAnimationFrame","links","getElementsByTagName","i","length","addEventListener","removeEventListener","Welcome","PageEffects_PageEffects","gadTitle","TitleBlock","title","subtitle","titleSize","subtitleSize","text-size-xxs","text-size-xs","text-size-s","text-size-m","text-size-l","text-size-xl","ExploreScore","exploreScore","size","circle-s","circle-m","circle-l","Topic","subdebates","ExploreScore_ExploreScore","Debates","TitleBlock_TitleBlock","Topic_Topic","GetNodeRevision","StoreAccessor","s","id","IsNaN","GetDoc","a","nodeRevisions","get","GetNodeRevisionsByTitle","nodeID","GetDocs","filters","WhereFilter","titleKey","concat","GetImage","images","url","sources","items","$ref","minItems","required","oneOf","GetValues_ForSchema","ImageType","name","pattern","author","link","allOf","if","enum","Writing","Speech","then","anyOf","prohibited","const","Webpage","description","previewWidth","sourceChains","creator","createdAt","MapNodeType","MapNodeType_Info","initialData","classCallCheck","childTypes","minWidth","maxWidth","CE","VSet","for","Category","Package","MultiChoiceQuestion","Claim","Argument","AccessLevel","ClaimForm","Polarity","MapType","rootNodeForMap","ownerMapID","currentRevision","parents","children","childrenOrder","multiPremiseArgument","layerPlusAnchorParents","schema","GetSchemaJSON","patternProperties","defineProperty","UUID_regex","_","form","seriesAnchor","polarity","UUID_regex_partial","_CE","note","noteInline","rootNode","defaultExpandDepth","defaultTimelineID","requireMapEditorsCanEdit","nodeDefaults","Schema","Including","apply","toConsumableArray","MapNodeRevision_Defaultable_props","featured","editorIDs","edits","editedAt","layers","timelines","PermissionInfoType","base","negation","yesNoQuestion","allTerms","mapID","ArgumentType","node","titles","termAttachments","argumentType","equation","references","quote","image","accessLevel","votingDisabled","permission_edit","permission_contribute","fontSizeOverride","widthOverride","nodes","mirrorChildrenFromXToY","xIsExtendedByY","mutuallyExclusiveGroup","restrictMirroringOfX","TagComp","createClass","key","value","compClass","TagComp_classes","find","As","displayName","nodeKeys","TagComp_MirrorChildrenFromXToY","_TagComp","_this","possibleConstructorReturn","getPrototypeOf","call","nodeX","nodeY","mirrorSupporting","mirrorOpposing","reversePolarities","disableDirectChildren","assertThisInitialized","inherits","TagComp_XIsExtendedByY","_TagComp2","_this2","result","prototype","mirrorComp_xConsToY","push","mirrorComp_yProsToX","AsMultiline","TagComp_MutuallyExclusiveGroup","_TagComp3","_this3","mirrorXProsAsYCons","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","Except","mirrorComp","err","return","TagComp_RestrictMirroringOfX","_TagComp4","_this4","blacklistAllMirrorParents","blacklistedMirrorParents","_i","_TagComp_classes","_compClass$key","_compClass$displayNam","CalculateTagCompKey","CalculateTagCompDisplayName","CalculateTagCompClassStatics","map","c","replace","ModifyString","m","startUpper_to_lower","lowerUpper_to_lowerSpaceLower","_i2","_autoSlotNames","slotName","RegExp","toUpperCase","GetTagCompClassByTag","tag","GetTagCompOfTag","GetNodeTags","nodeTags","GetNodeTagComps","tagID","unwrapCompositeTags","arguments","tagsToIgnore","tags","emptyArray_forLoading","SelectMany","includes","baseComp","GetFinalTagCompsForTag","comp","GetFinalTagComps","GetMaps","orderByEdits","mapsMap","maps","ObjectCE","VValues","OrderByDescending","ToNumber","GetMap","filter","Private","Public","fire","Firelink","SetDefaultFireOptions","require","GetAuth","userInfo","MeID","userInfo_raw","IsAuthValid","GetUser","userID","users","defaultPermissions","basic","verified","mod","admin","GetUserPermissionGroups","_ref","_GetUser","permissionGroups","CanGetBasicPermissions","userIDOrPermissions","permissions","IsString","HasBasicPermissions","HasModPermissions","HasAdminPermissions","IsUserCreatorOrMod","entity","CanContributeToNode","_revision$permission_","GetNodeL2","revision","current","editPerm","Anyone","Creator","MapEditors","_ref2","_map$editorIDs","Assert","_revision$permission_2","contributePerm","_ref3","_map$editorIDs2","main","GetRatingTypesForNode","FirstOrX","ReversePolarity","Supporting","Opposing","GetDisplayPolarityAtPath","path","parent","GetParentNodeL2","GetLinkUnderParent","parentForm","GetNodeForm","SplitStringBySlash_Cached","slice","join","basePolarity","Negation","GetDisplayPolarity","GetNode","E","AsNodeL2","GetNodeL3","GetNodeID","displayPolarity","IsNodeSubnode","GetParentNode","Base","AsNodeL3","pathOrParent","IsNodeL3","_parent$children","includeMirrorLinks","tagComps","_loop","mirrorChildren","GetNodeChildrenL3","nodeL3ForNodeAsMirrorChildInThisTag","child","Clone","NodeContributionInfo","proArgs","conArgs","NodeContributionInfo_ForPolarity","canAdd","hostNodeID","Any","_a$mirrorChildrenFrom","_a$mirrorChildrenFrom2","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","addForPolarities_short","_addForPolarities_sho","polarity_short","GetNodeDisplayText","baseClaim","GetNodeChildrenL2","text","latex","g1","g2","html","renderToString","ex","message","startsWith","firstSource","VURL","Parse","toString","domain_protocol","toLowerCase","missingTitleStrings","YesNoQuestion","HolderType","IsSinglePremiseArgument","IsPremiseOfSinglePremiseArgument","PathSegmentToNodeID","segment","ids","emptyForLoading","IsRootNode","VKeys","GetParentCount","GetParentNodeID","pathNodes","Last","parentNodeStr","XFromLast","childPath","childPathNodes","GetParentPath","ownNodeStr","LastOrX","CleanArray","array","GetNodeParents","GetNodeChildren","SlicePath","includeMirrorChildren","emptyArray","MapNode","informalArgumentsHolder","premiseAddHelper","_result","GetNodeMirrorChildren","mirrorChild","directChild","_loop2","tagComp","_result2","mirrorChildrenL3","mirrorChildrenL1","childTagComps","_comp$blacklistedMirr","childL3","AsNodeL1","nodeDirectChildren","otherChild","childPremise","GetPremiseOfSinglePremiseArgument","childPremiseTagComps","_GetPremiseOfSinglePr","index","earlierNodes","argumentNodeID","argument","ForLink_GetError","parentType","childType","parentTypeInfo","parentID","newChild","newHolderType","isAlreadyChild","currentHolderType","Relevance","Truth","GetHolderType","subcommandInfo","_CE2","baseText","parentsToIgnore","asPartOfMapDelete","nodeChildren","childrenToIgnore","GetFinalNodeTitle","GetQuestions","questions","mainMap_rootNodeID","sort","b","GetQuestionPositions","questionID","GetPositionReasons","positionID","Questions","observer","questionPositions","question","item","Position","positionCount","ctaUrl","react_default","createElement","Positions","useParams","positions","Position_Position","Reason","Reasons","position","reasons","Reason_Reason","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","linkRootPath","store","rootPathInDB","rootStore","firebase","initializeApp","Initialize","initDebateMapServerLink","App","basename","TopNav_TopNav","react_router","component","exact","Component","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.52d840df.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/gad-logo-small-white.86ba0532.png\";","module.exports = __webpack_public_path__ + \"static/media/gad-title.9e8f6898.png\";","import {AddSchema} from \"mobx-firelink\";\n\n// temp replaced\n// import {UserInfo as ProviderData} from \"firebase\";\ntype ProviderData = any;\n\nexport class User_Private {\n\t_key?: string;\n\t//displayName: string;\n\t//avatarUrl: string;\n\temail: string;\n\tproviderData: ProviderData[];\n\n\t// custom\n\tbackgroundID?: string;\n\tbackgroundCustom_enabled?: boolean;\n\tbackgroundCustom_color?: string;\n\tbackgroundCustom_url?: string;\n\tbackgroundCustom_position?: string;\n}\nAddSchema(\"User_Private\", {\n\tproperties: {\n\t\t//displayName: {type: \"string\"},\n\t\t//avatarUrl: {type: \"string\"},\n\t\temail: {type: \"string\"},\n\t\tproviderData: {type: \"array\"},\n\n\t\t// custom\n\t\tbackgroundID: {type: \"string\"},\n\t\tbackgroundCustom_enabled: {type: \"boolean\"},\n\t\tbackgroundCustom_color: {type: [\"null\", \"string\"]},\n\t\tbackgroundCustom_url: {type: \"string\"},\n\t\tbackgroundCustom_position: {type: \"string\"},\n\t},\n});","import {GetValues_ForSchema, Assert} from \"js-vextensions\";\nimport {AddSchema} from \"mobx-firelink\";\n\n// export type SourceChain = { [key: number]: Source; };\n// export type SourceChainI = {[key: number]: Source;};\n// export class SourceChain /*implements SourceChainI*/ {\n/* export class SourceChain extends Array {\n\t[key: number]: Source;\n\t0 = new Source();\n}; */\nexport class SourceChain {\n\tconstructor(sources: Source[] = []) {\n\t\tthis.sources = sources;\n\t}\n\tsources: Source[];\n}\n// AddSchema({patternProperties: {\"^[A-Za-z0-9_-]+$\": {$ref: \"Source\"}}, minProperties: 1}, \"SourceChain\");\nAddSchema(\"SourceChain\", {\n\tproperties: {\n\t\tsources: {items: {$ref: \"Source\"}, minItems: 1},\n\t},\n\trequired: [\"sources\"],\n});\n\nexport enum SourceType {\n\tSpeech = 10,\n\tWriting = 20,\n\t/* Image = 30,\n\tVideo = 40, */\n\tWebpage = 50,\n}\nAddSchema(\"SourceType\", {oneOf: GetValues_ForSchema(SourceType)});\n\nexport const Source_linkURLPattern = \"^https?://[^\\\\s/$.?#]+\\\\.[^\\\\s]+$\";\nexport class Source {\n\ttype = SourceType.Webpage;\n\tname: string;\n\tauthor: string;\n\tlink: string; // only the \"Webpage\" SourceType uses this (and this is all it uses atm)\n}\nAddSchema(\"Source\", {\n\tproperties: {\n\t\ttype: {$ref: \"SourceType\"},\n\t\tname: {pattern: \"\\\\S.*\"},\n\t\tauthor: {pattern: \"\\\\S.*\"},\n\t\tlink: {type: \"string\"}, // allow overriding url pattern; it just highlights possible mistakes\n\t\t// link: { format: 'uri' },\n\t\t// link: { pattern: Source_linkURLPattern },\n\t},\n\t// required: [\"name\", \"author\", \"link\"],\n\t/* anyOf: [\n\t\t{required: [\"name\"], prohibited: [\"link\"]},\n\t\t{required: [\"author\"], prohibited: [\"link\"]},\n\t\t{required: [\"link\"], prohibited: [\"name\", \"author\"]}\n\t], */\n\tallOf: [\n\t\t{\n\t\t\tif: {\n\t\t\t\tproperties: {\n\t\t\t\t\ttype: {enum: [SourceType.Writing, SourceType.Speech]},\n\t\t\t\t},\n\t\t\t},\n\t\t\tthen: {\n\t\t\t\tanyOf: [{required: [\"name\"]}, {required: [\"author\"]}],\n\t\t\t\tprohibited: [\"link\"],\n\t\t\t},\n\t\t\t// else: {prohibited: [\"name\", \"author\", \"link\"]},\n\t\t},\n\t\t{\n\t\t\tif: {\n\t\t\t\tproperties: {\n\t\t\t\t\ttype: {const: SourceType.Webpage},\n\t\t\t\t},\n\t\t\t},\n\t\t\tthen: {\n\t\t\t\trequired: [\"link\"],\n\t\t\t\tprohibited: [\"name\", \"author\"],\n\t\t\t},\n\t\t\t// else: {prohibited: [\"name\", \"author\", \"link\"]},\n\t\t},\n\t],\n});\n\nexport function GetSourceNamePlaceholderText(sourceType: SourceType) {\n\tif (sourceType == SourceType.Speech) return \"speech name\";\n\tif (sourceType == SourceType.Writing) return \"book/document name\";\n\t// if (sourceType == SourceType.Webpage) return \"(webpage name)\";\n\tAssert(false);\n}\nexport function GetSourceAuthorPlaceholderText(sourceType: SourceType) {\n\tif (sourceType == SourceType.Speech) return \"speaker\";\n\tif (sourceType == SourceType.Writing) return \"book/document author\";\n\t// if (sourceType == SourceType.Webpage) return \"(webpage name)\";\n\tAssert(false);\n}","import * as React from 'react'\nimport { Link } from 'react-router-dom'\nimport classNames from 'classnames'\n\nimport '../styles/TopNav.scss'\nimport logo from '../images/gad-logo-small-white.png'\n\nexport const TopNav = (props) => {\n  let [showMenu, setShowMenu] = React.useState(true)\n\n  const toggleMenu = (e) => {\n    if (showMenu) {\n      setShowMenu(false)\n    } else {\n      setShowMenu(true)\n    }\n  }\n\n  return (\n    <header>\n      <nav className=\"top-nav\">\n        <Link to=\"/\">\n          <img src={logo} alt=\"The Great American Debate\" />\n        </Link>\n        <button className=\"menu-button stylized-button stylized-button-small\" onClick={toggleMenu}>\n          Menu\n        </button>\n      </nav>\n      <aside className={classNames('main-menu', { hidden: showMenu })}>\n        <div className=\"main-menu-header\">\n          <button className=\"stylized-button main-menu-close\" onClick={toggleMenu}>\n            Close\n          </button>\n        </div>\n      </aside>\n    </header>\n  )\n}\n","import * as React from 'react'\n\nexport const PageEffects = (props) => {\n  const { animation, duration, options } = props\n\n  let keyframes = {\n    fadeOut: [\n      // keyframes\n      { opacity: 1 },\n      { opacity: 0 },\n    ],\n  }\n\n  let timingOptions = {\n    once: {\n      // timing options\n      duration: duration,\n      iterations: 1,\n      fill: 'forwards',\n    },\n  }\n\n  let linkClickHandler = (e) => {\n    e.preventDefault()\n    document.getElementsByClassName('page')[0].animate(keyframes[animation], timingOptions[options])\n    window.setTimeout(() => {\n      window.location = e.target.closest('a').href\n    }, duration)\n  }\n\n  let applyHandlerToLinks = () => {\n    window.requestAnimationFrame(() => {\n      let links = document.getElementsByTagName('a')\n\n      for (let i = 0; i < links.length; i++) {\n        links[i].addEventListener('click', linkClickHandler)\n      }\n    })\n    return () => {\n      let links = document.getElementsByTagName('a')\n\n      for (let i = 0; i < links.length; i++) {\n        links[i].removeEventListener('click', linkClickHandler)\n      }\n    }\n  }\n\n  React.useEffect(applyHandlerToLinks, [])\n\n  return null\n}\n","import * as React from 'react'\nimport { Link } from 'react-router-dom'\n\nimport { PageEffects } from '../components/PageEffects'\n\nimport '../styles/Welcome.scss'\nimport gadTitle from '../assets/gad-title.png'\n\nexport const Welcome = (props) => {\n  return (\n    <section className=\"page welcome\">\n      <PageEffects duration={200} animation=\"fadeOut\" options=\"once\" />\n      <div className=\"font-preloader\">\n        <span>Load</span> <span>the</span> <span>fonts</span>\n      </div>\n      <div className=\"top-container\">\n        <img className=\"title-image\" src={gadTitle} />\n        <h3 className=\"subheading\">\n          <span>america's arguments,</span> <span>all in one place</span>\n        </h3>\n      </div>\n      <div className=\"bottom-container\">\n        <Link to=\"/debates\" className=\"explore-button stylized-button drop-shadow\">\n          Explore\n        </Link>\n\n        <div className=\"welcome-animation\">\n          <div className=\"animation-container\">\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative reversed\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative reversed\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative\"></div>\n            </div>\n            <div className=\"speech-bubble-container\">\n              <div className=\"speech-bubble decorative\"></div>\n            </div>\n          </div>\n          <div className=\"animation-container\">\n            <div className=\"shadow\"></div>\n            <div className=\"shadow\"></div>\n            <div className=\"shadow\"></div>\n          </div>\n          <div className=\"animation-container\">\n            <div className=\"star-container\">\n              <div className=\"star\"></div>\n            </div>\n            <div className=\"star-container\">\n              <div className=\"star\"></div>\n            </div>\n            <div className=\"star-container\">\n              <div className=\"star\"></div>\n            </div>\n            <div className=\"star-container\">\n              <div className=\"star\"></div>\n            </div>\n            <div className=\"star-container\">\n              <div className=\"star\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  )\n}\n","import * as React from 'react'\nimport classNames from 'classnames'\n\nimport '../styles/TitleBlock.scss'\n\nexport const TitleBlock = (props) => {\n  const { title, subtitle, titleSize, subtitleSize } = props\n\n  return (\n    <div className=\"title-block\">\n      <h1\n        className={classNames(\n          { 'text-size-xxs': titleSize == 'xxs' },\n          { 'text-size-xs': titleSize == 'xs' },\n          { 'text-size-s': titleSize == 's' },\n          { 'text-size-m': titleSize == 'm' },\n          { 'text-size-l': titleSize == 'l' },\n          { 'text-size-xl': titleSize == 'xl' },\n        )}\n      >\n        {title}\n      </h1>\n      <h2\n        className={classNames(\n          'text-color-light',\n          { 'text-size-xxs': subtitleSize == 'xxs' },\n          { 'text-size-xs': subtitleSize == 'xs' },\n          { 'text-size-s': subtitleSize == 's' },\n          { 'text-size-m': subtitleSize == 'm' },\n          { 'text-size-l': subtitleSize == 'l' },\n          { 'text-size-xl': subtitleSize == 'xl' },\n        )}\n      >\n        {subtitle}\n      </h2>\n    </div>\n  )\n}\n","import * as React from 'react'\nimport classNames from 'classnames'\n\nimport '../styles/ExploreScore.scss'\n\nexport const ExploreScore = (props) => {\n  const { exploreScore, size } = props\n\n  return (\n    <button\n      className={classNames(\n        'explore-score',\n        'circle',\n        'bezel-xs',\n        'drop-shadow',\n        { 'circle-s': size === 's' },\n        { 'circle-m': !size || size === 'm' },\n        { 'circle-l': size === 'l' },\n      )}\n    >\n      <p>{exploreScore}%</p>\n      <p>explore score</p>\n    </button>\n  )\n}\n","import * as React from 'react'\nimport { Link } from 'react-router-dom'\n\nimport { ExploreScore } from './ExploreScore'\nimport '../styles/Topic.scss'\n\nexport const Topic = (props) => {\n  const { title, subdebates, exploreScore } = props\n\n  return (\n    <div className=\"topic-container\">\n      <button className=\"topic-title circle circle-l bezel-s\">\n        <h2>{title}</h2>\n      </button>\n      <button className=\"topic-search circle circle-s bezel-xs drop-shadow\">🔍</button>\n      <button className=\"topic-media circle circle-m bezel-xs drop-shadow\">\n        <p>media</p>\n      </button>\n      <ExploreScore exploreScore={38} />\n      <button className=\"topic-subdebates circle circle-m bezel-xs drop-shadow\">\n        <p>{subdebates}</p>\n        <p>sub-debates</p>\n      </button>\n      <button className=\"topic-help circle circle-s bezel-xs drop-shadow\">\n        <p>?</p>\n      </button>\n    </div>\n  )\n}\n","import * as React from 'react'\nimport { Link } from 'react-router-dom'\n\nimport { TitleBlock } from '../components/TitleBlock'\nimport { Topic } from '../components/Topic'\nimport '../styles/Debates.scss'\nimport { PageEffects } from '../components/PageEffects'\n\nexport const Debates = (props) => {\n  return (\n    <main className=\"page debates\">\n      <PageEffects duration={200} animation=\"fadeOut\" options=\"once\" />\n      <TitleBlock title=\"Welcome!\" subtitle=\"please explore and search\" />\n      <div className=\"bottom-container\">\n        <Topic title=\"Climate Change\" exploreScore={38} subdebates={170} />\n        <Link to=\"/questions\" className=\"page-cta\">\n          Get into the debate >\n        </Link>\n      </div>\n    </main>\n  )\n}\n","import {IsNaN} from \"js-vextensions\";\nimport {WhereFilter, GetDoc, GetDocs, StoreAccessor} from \"mobx-firelink\";\nimport {MapNodeRevision, TitleKey} from \"./nodes/@MapNodeRevision\";\n\nexport const GetNodeRevision = StoreAccessor(s=>(id: string): MapNodeRevision=>{\n\tif (id == null || IsNaN(id)) return null;\n\treturn GetDoc({}, a=>a.nodeRevisions.get(id));\n});\n\n// todo: make this use an actual query, to improve performance\n// todo2 (nvm, canceled): actually, maybe instead just use approach used for map-node-phrasings (having separate db-path for each node's phrasing-collection) -- assuming it has no unforeseen issues\n\n// removed this download-and-watch-whole-collection function because it slows down the website way too much\n/* export function GetNodeRevisions(nodeID: string): MapNodeRevision[] {\n\tconst entryMap = GetData({ collection: true }, 'nodeRevisions');\n\treturn CachedTransform('GetNodeRevisions', [nodeID], entryMap, () => (entryMap ? entryMap.VValues(true).filter(a => a && a.node == nodeID) : []));\n} */\n\n/* export async function GetNodeRevisionIDsForNode_OneTime(nodeID: UUID) {\n\tlet query = firestoreDB.collection(DBPath('nodeRevisions')) as CollectionReference | Query;\n\tquery = query.where('node', '==', nodeID);\n\n\tconst { docs } = await query.get();\n\tconst docIDs = docs.map(a => a.id);\n\treturn docIDs;\n} */\nexport const GetNodeRevisions = StoreAccessor(s=>(nodeID: string): MapNodeRevision[]=>{\n\t/* const entryMap = GetData_Query(\n\t\t{\n\t\t\t// key: `GetNodeRevisions_${nodeID}`,\n\t\t\twhereFilters: [new WhereFilter('node', '==', nodeID)],\n\t\t\tcollection: true,\n\t\t},\n\t\t'nodeRevisions',\n\t);\n\treturn entryMap ? entryMap.VValues(true).filter((a) => a && a.node == nodeID) : []; */\n\t// return entryMap ? entryMap.VValues(true).filter(a => a && a.node == nodeID) : [];\n\treturn GetDocs({\n\t\tfilters: [new WhereFilter(\"node\", \"==\", nodeID)],\n\t}, a=>a.nodeRevisions);\n});\nexport const GetNodeRevisionsByTitle = StoreAccessor(s=>(title: string, titleKey: TitleKey): MapNodeRevision[]=>{\n\treturn GetDocs({\n\t\tfilters: [new WhereFilter(`titles.${titleKey}`, \"==\", title)],\n\t}, a=>a.nodeRevisions);\n});","import {CachedTransform, IsNaN} from \"js-vextensions\";\nimport {GetDoc, GetDocs, StoreAccessor, WhereFilter} from \"mobx-firelink\";\nimport {Image} from \"./images/@Image\";\n\nexport const GetImage = StoreAccessor(s=>(id: string)=>{\n\tif (id == null || IsNaN(id)) return null;\n\treturn GetDoc({}, a=>a.images.get(id));\n});\n/* export async function GetImageAsync(id: string) {\n\treturn await GetDataAsync(`images/${id}`) as Image;\n} */\n\nexport const GetImages = StoreAccessor(s=>(): Image[]=>{\n\treturn GetDocs({}, a=>a.images);\n});\nexport const GetImagesByURL = StoreAccessor(s=>(url: string): Image[]=>{\n\treturn GetDocs({\n\t\tfilters: [new WhereFilter(\"url\", \"==\", url)],\n\t}, a=>a.images);\n});","import {GetValues_ForSchema, CE} from \"js-vextensions\";\nimport {AddSchema} from \"mobx-firelink\";\nimport {Source, SourceChain} from \"../nodeRevisions/@SourceChain\";\n\nexport enum ImageType {\n\tPhoto = 10,\n\tIllustration = 20,\n}\nAddSchema(\"ImageType\", {oneOf: GetValues_ForSchema(ImageType)});\n\nexport function GetNiceNameForImageType(type: ImageType) {\n\treturn ImageType[type].toLowerCase();\n}\n\nexport class Image {\n\tconstructor(initialData: {name: string, type: ImageType} & Partial<Image>) {\n\t\tthis.sourceChains = [\n\t\t\t{sources: [new Source()]},\n\t\t];\n\t\tCE(this).VSet(initialData);\n\t\t// this.createdAt = Date.now();\n\t}\n\n\t_key: string;\n\n\tname: string;\n\ttype: ImageType;\n\turl = \"\";\n\tdescription: string;\n\tpreviewWidth: number;\n\n\tsourceChains: SourceChain[];\n\n\tcreator: string;\n\tcreatedAt: number;\n}\nexport const Image_namePattern = '^[a-zA-Z0-9 ,\\'\"%\\\\-()\\\\/]+$';\nexport const Image_urlPattern = \"^https?://[^\\\\s/$.?#]+\\\\.[^\\\\s]+\\\\.(jpg|jpeg|gif|png)$\";\nAddSchema(\"Image\", {\n\tproperties: {\n\t\tname: {type: \"string\", pattern: Image_namePattern},\n\t\ttype: {$ref: \"ImageType\"},\n\t\t// url: { pattern: Image_urlPattern },\n\t\turl: {type: \"string\"}, // allow overriding url pattern; it just highlights possible mistakes\n\t\tdescription: {type: \"string\"},\n\t\tpreviewWidth: {type: [\"number\", \"null\"]},\n\n\t\tsourceChains: {items: {$ref: \"SourceChain\"}},\n\n\t\tcreator: {type: \"string\"},\n\t\tcreatedAt: {type: \"number\"},\n\t},\n\trequired: [\"name\", \"type\", \"url\", \"description\", \"sourceChains\", \"creator\", \"createdAt\"],\n});","import {Assert, CE} from \"js-vextensions\";\nimport {ClaimForm, MapNode, MapNodeL3, Polarity} from \"./@MapNode\";\n\nexport enum MapNodeType {\n\tCategory = 10,\n\tPackage = 20,\n\tMultiChoiceQuestion = 30,\n\tClaim = 40,\n\tArgument = 50,\n}\nexport class MapNodeType_Info {\n\tstatic for = {\n\t\t[MapNodeType.Category]: new MapNodeType_Info({\n\t\t\tchildTypes: [MapNodeType.Category, MapNodeType.Package, MapNodeType.MultiChoiceQuestion, MapNodeType.Claim],\n\t\t\tminWidth: 100, maxWidth: 250,\n\t\t\t/* mainRatingTypes: [\"significance\"],\n\t\t\totherRatingTypes: [], */\n\t\t}),\n\t\t[MapNodeType.Package]: new MapNodeType_Info({\n\t\t\tchildTypes: [MapNodeType.Claim],\n\t\t\tminWidth: 100, maxWidth: 250,\n\t\t\t/* mainRatingTypes: [\"significance\"],\n\t\t\totherRatingTypes: [], */\n\t\t}),\n\t\t[MapNodeType.MultiChoiceQuestion]: new MapNodeType_Info({\n\t\t\tchildTypes: [MapNodeType.Claim],\n\t\t\tminWidth: 100, maxWidth: 250,\n\t\t\t// minWidth: 100, maxWidth: 200, backgroundColor: \"230,150,50\",\n\t\t\t/* mainRatingTypes: [\"significance\"],\n\t\t\totherRatingTypes: [], */\n\t\t}),\n\t\t[MapNodeType.Claim]: new MapNodeType_Info({\n\t\t\tchildTypes: [MapNodeType.Argument],\n\t\t\tminWidth: 350, maxWidth: 550,\n\t\t\t// mainRatingTypes: [\"probability\", \"intensity\"],\n\t\t\t// mainRatingTypes: [\"probability\", \"support\"],\n\t\t\t/* mainRatingTypes: [\"probability\", \"truth\"],\n\t\t\totherRatingTypes: [], */\n\t\t}),\n\t\t[MapNodeType.Argument]: new MapNodeType_Info({\n\t\t\tchildTypes: [MapNodeType.Claim, MapNodeType.Argument],\n\t\t\tminWidth: 100, maxWidth: 300,\n\t\t\t/* mainRatingTypes: [\"strength\"],\n\t\t\totherRatingTypes: [], */\n\t\t}),\n\t} as {[key: string]: MapNodeType_Info};\n\n\tprivate constructor(initialData: Partial<MapNodeType_Info>) {\n\t\tCE(this).VSet(initialData);\n\t}\n\n\t// displayName: (parentNode: MapNodeL2)=>string;\n\tchildTypes: MapNodeType[];\n\tminWidth: number;\n\tmaxWidth: number;\n\t// fontSize?: number;\n\t// get fontSize() { return 14; }\n\t/* mainRatingTypes: RatingType[];\n\totherRatingTypes: RatingType[]; */\n}\n\nexport function GetMapNodeTypeDisplayName(type: MapNodeType, parentNode: MapNode, parentNodeForm: ClaimForm, polarity: Polarity) {\n\tif (type == MapNodeType.Category) return \"category\";\n\tif (type == MapNodeType.Package) return \"package\";\n\tif (type == MapNodeType.MultiChoiceQuestion) return \"multi-choice question\";\n\tif (type == MapNodeType.Claim) {\n\t\tif (parentNode && parentNode.type == MapNodeType.Category) { return \"claim (in question form)\"; }\n\t\treturn \"claim\";\n\t}\n\tif (type == MapNodeType.Argument) {\n\t\treturn polarity == Polarity.Supporting ? \"supporting argument\" : \"opposing argument\";\n\t}\n\tAssert(false, \"Invalid node type.\");\n}","import {GetValues_ForSchema, CE} from \"js-vextensions\";\nimport {AddAJVExtraCheck, AddSchema, GetSchemaJSON, UUID, UUID_regex, UUID_regex_partial} from \"mobx-firelink\";\nimport {MapNodeRevision} from \"./@MapNodeRevision\";\nimport {MapNodeType} from \"./@MapNodeType\";\n\n// these are 22-chars, matching 22-char uuids/slug-ids\nexport const globalMapID = \"GLOBAL_MAP_00000000001\";\nexport const globalRootNodeID = \"GLOBAL_ROOT_0000000001\";\n\nexport enum AccessLevel {\n\tBasic = 10,\n\tVerified = 20, // for accounts we're pretty sure are legitimate (an actual person's only account)\n\tMod = 30,\n\tAdmin = 40,\n}\n\nexport enum ClaimForm {\n\tBase = 10,\n\tNegation = 20,\n\tYesNoQuestion = 30,\n}\n\nexport class MapNode {\n\tconstructor(initialData: {type: MapNodeType} & Partial<MapNode>) {\n\t\tCE(this).VSet(initialData);\n\t}\n\n\t_key?: string;\n\ttype?: MapNodeType;\n\tcreator?: string;\n\tcreatedAt: number;\n\trootNodeForMap?: string;\n\townerMapID?: string;\n\n\tcurrentRevision: string;\n\n\tparents: ParentSet;\n\tchildren: ChildSet;\n\tchildrenOrder: UUID[]; // only set when type:argument\n\t// talkRoot: number;\n\tmultiPremiseArgument?: boolean;\n\n\t// if subnode\n\tlayerPlusAnchorParents: LayerPlusAnchorParentSet;\n\t/* layerOwner: UUID;\n\tlayerAnchorNode: UUID; */\n\n\t// local-only\n\tinformalArgumentsHolder?: boolean;\n\tpremiseAddHelper?: boolean;\n}\n// export const MapNode_id = UUID_regex;\n// export const MapNode_chainAfterFormat = \"^(\\\\[start\\\\]|[0-9]+)$\";\nAddSchema(\"MapNode\", {\n\tproperties: {\n\t\ttype: {oneOf: GetValues_ForSchema(MapNodeType)},\n\t\tcreator: {type: \"string\"},\n\t\tcreatedAt: {type: \"number\"},\n\t\trootNodeForMap: {$ref: \"UUID\"},\n\t\townerMapID: {$ref: \"UUID\"},\n\n\t\tcurrentRevision: {type: \"string\"},\n\n\t\tparents: {$ref: \"ParentSet\"},\n\t\tchildren: {$ref: \"ChildSet\"},\n\t\tchildrenOrder: {items: {$ref: \"UUID\"}},\n\t\t// talkRoot: {type: \"number\"},\n\t\tmultiPremiseArgument: {type: \"boolean\"},\n\n\t\tlayerPlusAnchorParents: {$ref: \"LayerPlusAnchorParentSet\"},\n\t\t// layerOwner: { $ref: 'UUID' },\n\t},\n\trequired: [\"type\", \"creator\", \"createdAt\", \"currentRevision\"],\n\t/* allOf: [\n\t\t// if an argument, require \"childrenOrder\" prop\n\t\t{\n\t\t\tif: {\n\t\t\t\tproperties: {\n\t\t\t\t\ttype: {const: MapNodeType.Argument},\n\t\t\t\t}\n\t\t\t},\n\t\t\tthen: {required: [\"childrenOrder\"]},\n\t\t\telse: {prohibited: [\"childrenOrder\"]}\n\t\t}\n\t], */\n});\nAddSchema(\"MapNode_Partial\", (()=>{\n\tconst schema = GetSchemaJSON(\"MapNode\");\n\t// schema.required = (schema.required as string[]).Except('creator', 'createdAt');\n\tschema.required = [\"type\"];\n\treturn schema;\n})());\n// disabled for now, simply because we haven't finished making all places that manipulate \"MapNode.children\" reliably update \"MapNode.childrenOrder\" as well\n/* AddAJVExtraCheck('MapNode', (node: MapNode) => {\n\tif (node.type == MapNodeType.Argument) {\n\t\tif ((node.childrenOrder ? node.childrenOrder.length : 0) !== (node.children ? node.children.VKeys().length : 0)) {\n\t\t\treturn 'Children and childrenOrder lengths differ!';\n\t\t}\n\t}\n}); */\n\n// helpers\n// export type MapNodeL2 = MapNode & {finalType: MapNodeType};\n/** MapNode, except with the current-revision data attached. */\nexport interface MapNodeL2 extends MapNode {\n\tcurrent: MapNodeRevision;\n}\n/** MapNodeL2, except with positional data (and derivations, eg. display-polarity) attached. */\nexport interface MapNodeL3 extends MapNodeL2 {\n\t/** For this node (with the given ancestors): How the node would be displayed -- \"supporting\" being green, \"opposing\" being red. */\n\tdisplayPolarity: Polarity;\n\tlink: ChildEntry;\n\t//linkToParent: ChildEntry;\n\t//parentLinkToGrandParent: ChildEntry;\n}\n\nexport enum Polarity {\n\tSupporting = 10,\n\tOpposing = 20,\n}\n\n// regular parents\n// ==========\n\nexport type ParentSet = { [key: string]: ParentEntry; };\nAddSchema(\"ParentSet\", {patternProperties: {[UUID_regex]: {$ref: \"ParentEntry\"}}});\nexport type ParentEntry = { _: boolean; };\nAddSchema(\"ParentEntry\", {\n\tproperties: {_: {type: \"boolean\"}},\n\trequired: [\"_\"],\n});\n\nexport type ChildSet = { [key: string]: ChildEntry; };\nAddSchema(\"ChildSet\", {patternProperties: {[UUID_regex]: {$ref: \"ChildEntry\"}}});\nexport type ChildEntry = {\n\t_: boolean;\n\tform?: ClaimForm;\n\tseriesAnchor?: boolean;\n\tpolarity?: Polarity;\n\n\t// runtime only\n\t_mirrorLink?: boolean;\n};\nAddSchema(\"ChildEntry\", {\n\tproperties: {\n\t\t_: {type: \"boolean\"},\n\t\tform: {oneOf: GetValues_ForSchema(ClaimForm)},\n\t\tseriesAnchor: {type: [\"null\", \"boolean\"]},\n\t\tpolarity: {oneOf: GetValues_ForSchema(Polarity)},\n\t},\n\trequired: [\"_\"],\n});\n\n// layer+anchor parents (for if subnode)\n// ==========\n\nexport type LayerPlusAnchorParentSet = { [key: string]: boolean; };\nAddSchema(\"LayerPlusAnchorParentSet\", {patternProperties: {[`${UUID_regex_partial}\\\\+${UUID_regex_partial}`]: {type: \"boolean\"}}});","import {GetValues_ForSchema, CE} from \"js-vextensions\";\nimport {AddSchema, GetSchemaJSON, Schema, UUID_regex} from \"mobx-firelink\";\nimport {ObservableMap} from \"mobx\";\nimport {MapNodeRevision_Defaultable, MapNodeRevision_Defaultable_props, MapNodeRevision_Defaultable_DefaultsForMap} from \"../nodes/@MapNodeRevision\";\n\nexport enum MapType {\n\tPrivate = 10,\n\tPublic = 20,\n\tGlobal = 30,\n}\nexport class Map {\n\tconstructor(initialData: {name: string, type: MapType, creator: string} & Partial<Map>) {\n\t\tCE(this).VSet(initialData);\n\t\t// this.createdAt = Date.now();\n\t\tif (!(\"requireMapEditorsCanEdit\" in initialData)) {\n\t\t\tthis.requireMapEditorsCanEdit = this.type == MapType.Private;\n\t\t}\n\t\tif (!(\"nodeDefaults\" in initialData)) {\n\t\t\tthis.nodeDefaults = MapNodeRevision_Defaultable_DefaultsForMap(this.type);\n\t\t}\n\t}\n\n\t_key: string;\n\tname: string;\n\tnote: string;\n\tnoteInline = true;\n\ttype: MapType;\n\trootNode: string;\n\tdefaultExpandDepth = 2;\n\tdefaultTimelineID: string;\n\trequireMapEditorsCanEdit: boolean;\n\t// allowPublicNodes = true; // todo\n\tnodeDefaults: MapNodeRevision_Defaultable;\n\tfeatured: boolean;\n\teditorIDs: string[];\n\n\tcreator: string;\n\tcreatedAt: number;\n\tedits: number;\n\teditedAt: number;\n\n\tlayers: {[key: string]: boolean};\n\ttimelines: {[key: string]: boolean};\n}\nexport const Map_namePattern = '^[a-zA-Z0-9 ,\\'\"%:.?\\\\-()\\\\/]+$';\n// export const Map_namePattern = '^\\\\S.*$'; // must start with non-whitespace // todo: probably switch to a more lax pattern like this, eg. so works for other languages\nAddSchema(\"Map\", [\"MapNodeRevision\"], ()=>({\n\tproperties: {\n\t\tname: {type: \"string\", pattern: Map_namePattern},\n\t\tnote: {type: \"string\"},\n\t\tnoteInline: {type: \"boolean\"},\n\t\ttype: {oneOf: GetValues_ForSchema(MapType)},\n\t\trootNode: {type: \"string\"},\n\t\tdefaultExpandDepth: {type: \"number\"},\n\t\tdefaultTimelineID: {type: \"string\"},\n\t\trequireMapEditorsCanEdit: {type: \"boolean\"},\n\t\tnodeDefaults: Schema({\n\t\t\tproperties: CE(GetSchemaJSON(\"MapNodeRevision\").properties).Including(...MapNodeRevision_Defaultable_props),\n\t\t}),\n\t\tfeatured: {type: \"boolean\"},\n\t\t// editors: { patternProperties: { [UUID_regex]: { type: 'boolean' } } },\n\t\teditorIDs: {items: {type: \"string\"}},\n\n\t\tcreator: {type: \"string\"},\n\t\tcreatedAt: {type: \"number\"},\n\t\tedits: {type: \"number\"},\n\t\teditedAt: {type: \"number\"},\n\n\t\tlayers: {patternProperties: {[UUID_regex]: {type: \"boolean\"}}},\n\t\ttimelines: {patternProperties: {[UUID_regex]: {type: \"boolean\"}}},\n\t},\n\trequired: [\"name\", \"type\", \"rootNode\", \"creator\", \"createdAt\"],\n}));","import {GetValues_ForSchema, CE} from \"js-vextensions\";\nimport {AddSchema, GetSchemaJSON} from \"mobx-firelink\";\nimport {QuoteAttachment} from \"../nodeRevisions/@QuoteAttachment\";\nimport {MapType} from \"../maps/@Map\";\nimport {ImageAttachment} from \"../nodeRevisions/@ImageAttachment\";\nimport {AccessLevel} from \"./@MapNode\";\nimport {EquationAttachment} from \"../nodeRevisions/@EquationAttachment\";\nimport {TermAttachment} from \"../nodeRevisions/@TermAttachment\";\nimport {ReferencesAttachment} from \"../nodeRevisions/@ReferencesAttachment\";\n\nexport type TitleKey = \"base\" | \"negation\" | \"yesNoQuestion\";\nexport const TitleKey_values = [\"base\", \"negation\", \"yesNoQuestion\"];\nexport class TitlesMap {\n\tbase?: string;\n\tnegation?: string;\n\tyesNoQuestion?: string;\n\n\t// allTerms?: string[];\n\t// allTerms?: ObservableMap<string, boolean>;\n\tallTerms?: {[key: string]: boolean};\n}\nAddSchema(\"TitlesMap\", {\n\tproperties: {\n\t\tbase: {type: \"string\"},\n\t\tnegation: {type: \"string\"},\n\t\tyesNoQuestion: {type: \"string\"},\n\n\t\t// allTerms: { items: { type: 'string' } },\n\t\tallTerms: {type: \"object\"},\n\t},\n});\n\nexport enum PermissionInfoType {\n\tCreator = 10,\n\tMapEditors = 20,\n\tAnyone = 30,\n}\nexport class PermissionInfo {\n\tconstructor(initialData: Partial<PermissionInfo>) {\n\t\tCE(this).VSet(initialData);\n\t}\n\ttype: PermissionInfoType;\n}\nAddSchema(\"PermissionInfo\", {\n\tproperties: {\n\t\ttype: {oneOf: GetValues_ForSchema(PermissionInfoType)},\n\t\tmapID: {type: \"string\"},\n\t},\n\trequired: [\"type\"],\n});\n\nexport const MapNodeRevision_Defaultable_props = [\"accessLevel\", \"votingDisabled\", \"permission_edit\", \"permission_contribute\"] as const;\nexport type MapNodeRevision_Defaultable = Pick<MapNodeRevision, \"accessLevel\" | \"votingDisabled\" | \"permission_edit\" | \"permission_contribute\">;\nexport function MapNodeRevision_Defaultable_DefaultsForMap(mapType: MapType): MapNodeRevision_Defaultable {\n\treturn {\n\t\taccessLevel: AccessLevel.Basic,\n\t\tvotingDisabled: false,\n\t\tpermission_edit: new PermissionInfo({type: mapType == MapType.Private ? PermissionInfoType.MapEditors : PermissionInfoType.Creator}),\n\t\tpermission_contribute: new PermissionInfo({type: mapType == MapType.Private ? PermissionInfoType.MapEditors : PermissionInfoType.Anyone}),\n\t};\n}\n\nexport class MapNodeRevision {\n\tconstructor(initialData: Partial<MapNodeRevision>) {\n\t\tCE(this).VSet(initialData);\n\t}\n\n\t_key?: string;\n\tnode: string; // probably todo: rename to nodeID\n\tcreator?: string; // probably todo: rename to creatorID\n\tcreatedAt: number;\n\t// updatedAt: number;\n\t// approved = false;\n\n\t// text\n\ttitles = {base: \"\"} as TitlesMap;\n\tnote: string;\n\ttermAttachments: TermAttachment[];\n\targumentType: ArgumentType;\n\n\t// attachment\n\tequation: EquationAttachment;\n\treferences: ReferencesAttachment;\n\tquote: QuoteAttachment;\n\timage: ImageAttachment;\n\n\t// permissions\n\t// only applied client-side; would need to be in protected branch of tree (or use a long, random, and unreferenced node-id) to be \"actually\" inaccessible\n\taccessLevel = AccessLevel.Basic;\n\t// voteLevel = AccessLevel.Basic;\n\tvotingDisabled: boolean;\n\tpermission_edit = new PermissionInfo({type: PermissionInfoType.Creator});\n\tpermission_contribute = new PermissionInfo({type: PermissionInfoType.Anyone});\n\n\t// others\n\tfontSizeOverride: number;\n\twidthOverride: number;\n}\n// export const MapNodeRevision_titlePattern = `(^\\\\S$)|(^\\\\S.*\\\\S$)`; // must start and end with non-whitespace\nexport const MapNodeRevision_titlePattern = \"^\\\\S.*$\"; // must start with non-whitespace\nAddSchema(\"MapNodeRevision\", {\n\tproperties: {\n\t\tnode: {type: \"string\"},\n\t\tcreator: {type: \"string\"},\n\t\tcreatedAt: {type: \"number\"},\n\t\t//approved: {type: \"boolean\"},\n\n\t\t// text\n\t\ttitles: {\n\t\t\tproperties: {\n\t\t\t\t// base: {pattern: MapNodeRevision_titlePattern}, negation: {pattern: MapNodeRevision_titlePattern}, yesNoQuestion: {pattern: MapNodeRevision_titlePattern},\n\t\t\t\tbase: {type: \"string\"}, negation: {type: \"string\"}, yesNoQuestion: {type: \"string\"},\n\t\t\t},\n\t\t\t// required: [\"base\", \"negation\", \"yesNoQuestion\"],\n\t\t},\n\t\tnote: {type: [\"null\", \"string\"]}, // add null-type, for later when the payload-validation schema is derived from the main schema\n\t\ttermAttachments: {items: {$ref: \"TermAttachment\"}},\n\t\targumentType: {$ref: \"ArgumentType\"},\n\n\t\t// attachment\n\t\tequation: {$ref: \"EquationAttachment\"},\n\t\treferences: {$ref: \"ReferencesAttachment\"},\n\t\tquote: {$ref: \"QuoteAttachment\"},\n\t\timage: {$ref: \"ImageAttachment\"},\n\n\t\t// permissions\n\t\taccessLevel: {oneOf: GetValues_ForSchema(AccessLevel).concat({const: null})},\n\t\tvotingDisabled: {type: [\"null\", \"boolean\"]},\n\t\t// voteLevel: { oneOf: GetValues_ForSchema(AccessLevel).concat({ const: null }) }, // not currently used\n\t\tpermission_edit: {$ref: \"PermissionInfo\"},\n\t\tpermission_contribute: {$ref: \"PermissionInfo\"},\n\n\t\t// others\n\t\tfontSizeOverride: {type: [\"number\", \"null\"]},\n\t\twidthOverride: {type: [\"number\", \"null\"]},\n\t},\n\trequired: [\"node\", \"creator\", \"createdAt\"],\n\tallOf: [\n\t\t// if not an argument or content-node, require \"titles\" prop\n\t\t{\n\t\t\tif: {prohibited: [\"argumentType\", \"equation\", \"quote\", \"image\"]},\n\t\t\tthen: {required: [\"titles\"]},\n\t\t},\n\t],\n});\nAddSchema(\"MapNodeRevision_Partial\", (()=>{\n\tconst schema = GetSchemaJSON(\"MapNodeRevision\");\n\t// schema.required = (schema.required as string[]).Except('creator', 'createdAt');\n\tschema.required = [];\n\treturn schema;\n})());\n\n// argument\n// ==========\n\nexport enum ArgumentType {\n\tAny = 10,\n\tAnyTwo = 15,\n\tAll = 20,\n}\nAddSchema(\"ArgumentType\", {oneOf: GetValues_ForSchema(ArgumentType)});\n\nexport function GetArgumentTypeDisplayText(type: ArgumentType) {\n\treturn {Any: \"any\", AnyTwo: \"any two\", All: \"all\"}[ArgumentType[type]];\n}","import {AddSchema, UUID_regex, GetSchemaJSON, Validate} from \"mobx-firelink\";\nimport {GetValues_ForSchema, ModifyString, CE} from \"js-vextensions\";\nimport {Polarity} from \"../nodes/@MapNode\";\n\nexport class MapNodeTag {\n\tconstructor(initialData: Partial<MapNodeTag>) {\n\t\tCE(this).VSet(initialData);\n\t}\n\n\t_key?: string;\n\tcreator: string;\n\tcreatedAt: number;\n\n\t//type: MapNodeTagType;\n\t//nodes: {[key: string]: string};\n\tnodes: string[];\n\n\t// type-specific fields (ie. tag comps)\n\tmirrorChildrenFromXToY: TagComp_MirrorChildrenFromXToY;\n\txIsExtendedByY: TagComp_XIsExtendedByY;\n\tmutuallyExclusiveGroup: TagComp_MutuallyExclusiveGroup;\n\trestrictMirroringOfX: TagComp_RestrictMirroringOfX;\n}\nAddSchema(\"MapNodeTag\", {\n\tproperties: {\n\t\tcreator: {type: \"string\"},\n\t\tcreatedAt: {type: \"number\"},\n\n\t\t//type: {$ref: \"MapNodeTagType\"},\n\t\t//nodes: {patternProperties: {[UUID_regex]: {type: \"string\"}}},\n\t\tnodes: {items: {$ref: \"UUID\"}},\n\n\t\tmirrorChildrenFromXToY: {$ref: \"TagComp_MirrorChildrenFromXToY\"},\n\t\txIsExtendedByY: {$ref: \"TagComp_XIsExtendedByY\"},\n\t\tmutuallyExclusiveGroup: {$ref: \"TagComp_MutuallyExclusiveGroup\"},\n\t\trestrictMirroringOfX: {$ref: \"TagComp_RestrictMirroringOfX\"},\n\t},\n\trequired: [\"creator\", \"createdAt\", \"nodes\"],\n});\n\n// tag comps\n// ==========\n\nexport abstract class TagComp {\n\tstatic key: string;\n\tstatic displayName: string;\n\tstatic description: string;\n\tstatic nodeKeys: string[]; // fields whose values should be added to MapNodeTag.nodes array (field-value can be a node-id string, or an array of such strings)\n\n\t/** Has side-effect: Casts data to its original class/type. */\n\tGetFinalTagComps(): TagComp[] {\n\t\tlet compClass = GetTagCompClassByKey(this[\"_key\"]);\n\t\tif (compClass) return [CE(this).As(compClass as any)];\n\t\treturn [this];\n\t}\n}\n\n/*export class TagComp_ExampleBasedClaim extends TagComp {\n\t//static key = \"exampleBasedClaim\";\n\tstatic displayName = \"example-based claim\";\n\tstatic description = \"Makes-so only arguments of a given polarity can be added; used for claims which default to true/false, in the absense of arguments to the contrary.\";\n\tstatic nodeKeys = [\"nodeX\"];\n\n\tconstructor(initialData?: Partial<TagComp_ExampleBasedClaim>) { super(); this.VSet(initialData); }\n\n\tnodeX: string;\n\tpolarityAllowed: Polarity;\n}\nAddSchema(\"TagComp_ExampleBasedClaim\", {\n\tproperties: {\n\t\tnodeX: {$ref: \"UUID\"},\n\t\tpolarityAllowed: {$ref: \"Polarity\"},\n\t},\n});*/\n\nexport class TagComp_MirrorChildrenFromXToY extends TagComp {\n\t//static key = \"mirrorChildrenFromXToY\";\n\tstatic displayName = \"mirror children from X to Y\";\n\tstatic description = \"Makes-so any children of node-x (matching the parameters) are shown as children of node-y. (only usable for claims currently)\";\n\tstatic nodeKeys = [\"nodeX\", \"nodeY\"];\n\n\tconstructor(initialData?: Partial<TagComp_MirrorChildrenFromXToY>) { super(); CE(this).VSet(initialData); }\n\n\tnodeX: string;\n\tnodeY: string;\n\tmirrorSupporting = true;\n\tmirrorOpposing = true;\n\treversePolarities = false;\n\tdisableDirectChildren = false;\n\t//overrideDirectChildren = false;\n\t//recursive = false;\n}\nAddSchema(\"TagComp_MirrorChildrenFromXToY\", {\n\tproperties: {\n\t\tnodeX: {$ref: \"UUID\"},\n\t\tnodeY: {$ref: \"UUID\"},\n\t\tmirrorSupporting: {type: \"boolean\"},\n\t\tmirrorOpposing: {type: \"boolean\"},\n\t\treversePolarities: {type: \"boolean\"},\n\t\tdisableDirectChildren: {type: \"boolean\"},\n\t},\n});\n\nexport class TagComp_XIsExtendedByY extends TagComp {\n\tstatic displayName = \"X is extended by Y (composite)\";\n\tstatic description = CE(`\n\t\tMeaning: claim Y is the same as claim X, except it is wider-scoped (and thus weaker) than X -- along some consistent axis/criteria of a series.\n\t\tExample: X (we should charge at least $50) is extended by Y (we should charge at least $100).\n\t\tEffect: Makes-so any con-args of X (base) are mirrored as con-args of Y (extension), and any pro-args of Y (extension) are mirrored as pro-args of X (base).\n\t`).AsMultiline(0);\n\tstatic nodeKeys = [\"nodeX\", \"nodeY\"];\n\n\tconstructor(initialData?: Partial<TagComp_XIsExtendedByY>) { super(); CE(this).VSet(initialData); }\n\n\tnodeX: string;\n\tnodeY: string;\n\n\tGetFinalTagComps() {\n\t\tlet result = super.GetFinalTagComps();\n\n\t\tlet mirrorComp_xConsToY = new TagComp_MirrorChildrenFromXToY({\n\t\t\tnodeX: this.nodeX,\n\t\t\tnodeY: this.nodeY,\n\t\t\tmirrorSupporting: false,\n\t\t\tmirrorOpposing: true,\n\t\t});\n\t\tresult.push(mirrorComp_xConsToY);\n\n\t\tlet mirrorComp_yProsToX = new TagComp_MirrorChildrenFromXToY({\n\t\t\tnodeX: this.nodeY,\n\t\t\tnodeY: this.nodeX,\n\t\t\tmirrorSupporting: true,\n\t\t\tmirrorOpposing: false,\n\t\t});\n\t\tresult.push(mirrorComp_yProsToX);\n\n\t\treturn result;\n\t}\n}\nAddSchema(\"TagComp_XIsExtendedByY\", {\n\tproperties: {\n\t\tnodeX: {$ref: \"UUID\"},\n\t\tnodeY: {$ref: \"UUID\"},\n\t},\n});\n\nexport class TagComp_MutuallyExclusiveGroup extends TagComp {\n\tstatic displayName = \"mutually exclusive group (composite)\";\n\tstatic description = CE(`\n\t\tMarks a set of nodes as being mutually exclusive with each other.\n\t\t(common use: having each one's pro-args be mirrored as con-args of the others)\n\t`).AsMultiline(0);\n\tstatic nodeKeys = [\"nodes\"];\n\n\tconstructor(initialData?: Partial<TagComp_MutuallyExclusiveGroup>) { super(); CE(this).VSet(initialData); }\n\n\tnodes = [] as string[];\n\tmirrorXProsAsYCons = true;\n\n\tGetFinalTagComps() {\n\t\tlet result = super.GetFinalTagComps();\n\t\tif (this.mirrorXProsAsYCons) {\n\t\t\tfor (let nodeX of this.nodes) {\n\t\t\t\tfor (let nodeY of CE(this.nodes).Except(nodeX)) {\n\t\t\t\t\tlet mirrorComp = new TagComp_MirrorChildrenFromXToY({\n\t\t\t\t\t\tnodeX, nodeY,\n\t\t\t\t\t\tmirrorSupporting: true,\n\t\t\t\t\t\tmirrorOpposing: false,\n\t\t\t\t\t\treversePolarities: true,\n\t\t\t\t\t});\n\t\t\t\t\tresult.push(mirrorComp);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\nAddSchema(\"TagComp_MutuallyExclusiveGroup\", {\n\tproperties: {\n\t\tnodes: {items: {$ref: \"UUID\"}},\n\t\tmirrorXProsAsYCons: {type: \"boolean\"},\n\t},\n});\n\nexport class TagComp_RestrictMirroringOfX extends TagComp {\n\tstatic displayName = \"restrict mirroring of X\";\n\tstatic description = \"Restricts mirroring of node X, by blacklisting certain mirror-parents, or mirror-parents in general.\";\n\tstatic nodeKeys = [\"nodeX\", \"blacklistedMirrorParents\"];\n\n\tconstructor(initialData?: Partial<TagComp_RestrictMirroringOfX>) { super(); CE(this).VSet(initialData); }\n\n\tnodeX: string;\n\tblacklistAllMirrorParents = true;\n\tblacklistedMirrorParents = [] as string[];\n}\nAddSchema(\"TagComp_RestrictMirroringOfX\", {\n\tproperties: {\n\t\tnodeX: {$ref: \"UUID\"},\n\t\tblacklistAllMirrorParents: {type: \"boolean\"},\n\t\tblacklistedMirrorParents: {items: {$ref: \"UUID\"}},\n\t},\n});\n\n// tag comp meta\n// ==========\n\nexport const TagComp_classes = [\n\tTagComp_MirrorChildrenFromXToY,\n\tTagComp_XIsExtendedByY,\n\tTagComp_MutuallyExclusiveGroup,\n\tTagComp_RestrictMirroringOfX,\n] as const;\nexport type TagComp_Class = typeof TagComp_classes[number];\nCalculateTagCompClassStatics();\nexport const TagComp_keys = TagComp_classes.map(c=>c.key);\nexport const TagComp_names = TagComp_classes.map(c=>c.displayName);\n\n// use class-names to calculate keys and display-names\nfunction CalculateTagCompClassStatics() {\n\tfor (const compClass of TagComp_classes) {\n\t\tcompClass.key = compClass.key ?? CalculateTagCompKey(compClass.name);\n\t\tcompClass.displayName = compClass.displayName ?? CalculateTagCompDisplayName(compClass.name);\n\t}\n}\n\nexport function CalculateTagCompKey(className: string) {\n\t//return GetSchemaJSON(\"MapNodeTag\").properties.Pairs().find(a=>a.value.$ref == className).key;\n\tlet displayName = className.replace(/TagComp_/, \"\");\n\tdisplayName = ModifyString(displayName, m=>[m.startUpper_to_lower]);\n\treturn displayName;\n}\nexport function GetTagCompClassByKey(key: string) {\n\treturn TagComp_classes.find(a=>a.key == key);\n}\nexport function CalculateTagCompDisplayName(className: string) {\n\tconst autoSlotNames = [\"x\", \"y\", \"z\"];\n\tlet displayName = className.replace(/TagComp_/, \"\");\n\tdisplayName = ModifyString(displayName, m=>[m.startUpper_to_lower, m.lowerUpper_to_lowerSpaceLower]);\n\tfor (const slotName of autoSlotNames) {\n\t\tdisplayName = displayName.replace(new RegExp(`(^| )${slotName}( |$)`), slotName.toUpperCase());\n\t}\n\treturn displayName;\n}\nexport function GetTagCompClassByDisplayName(displayName: string) {\n\treturn TagComp_classes.find(a=>a.displayName == displayName);\n}\nexport function GetTagCompClassByTag(tag: MapNodeTag) {\n\treturn TagComp_classes.find(a=>a.key in tag);\n}\nexport function GetTagCompOfTag(tag: MapNodeTag): TagComp {\n\tlet compClass = GetTagCompClassByTag(tag);\n\treturn tag[compClass.key];\n}\n\n/*export type MapNodeTagType = typeof TagComp_classes[number];\nexport const MapNodeTagType_values = [\"mirror children from X to Y\"] as const; //, \"example-based claim\", \"X extends Y\"];\n//AddSchema(\"MapNodeTagType\", {oneOf: MapNodeTagType_values.map(val=>({const: val}))});\nexport const MapNodeTagType_keys = MapNodeTagType_values.map(type=>ConvertNodeTagTypeToKey(type));\nexport function ConvertNodeTagTypeToKey(type: MapNodeTagType) {\n\treturn ModifyString(type, m=>[m.spaceLower_to_spaceUpper, m.removeSpaces, m.hyphenLower_to_hyphenUpper, m.removeHyphens]);\n}\nexport function GetNodeTagKey(tag: MapNodeTag) {\n\treturn MapNodeTagType_keys.find(key=>key in tag);\n}\nexport function GetNodeTagType(tag: MapNodeTag) {\n\tconst compKeyIndex = MapNodeTagType_keys.findIndex(key=>key in tag);\n\treturn MapNodeTagType_values[compKeyIndex];\n}*/\n\nexport function CalculateNodeIDsForTagComp(tagComp: TagComp, compClass: TagComp_Class) {\n\t/*let compClass = GetTagCompClassByTag(tag);\n\tlet comp = GetTagCompOfTag(tag);*/\n\t//let compClass = GetTagCompClassByKey(tagComp[\"_key\"]);\n\treturn CE(compClass.nodeKeys).SelectMany(key=> {\n\t\tlet nodeKeyValue = tagComp[key];\n\t\tlet nodeIDsForKey = Array.isArray(nodeKeyValue) ? nodeKeyValue : [nodeKeyValue];\n\t\treturn nodeIDsForKey.filter(nodeID=>Validate(\"UUID\", nodeID) == null);\n\t});\n}","import {WhereFilter, GetDoc, GetDocs, StoreAccessor} from \"mobx-firelink\";\nimport {emptyArray_forLoading, CE} from \"js-vextensions\";\nimport {MapNodePhrasing} from \"./nodePhrasings/@MapNodePhrasing\";\nimport {MapNodeTag, TagComp, GetTagCompClassByTag, GetTagCompOfTag} from \"./nodeTags/@MapNodeTag\";\n\n// todo: add and use some sort of system where mobx-firelink auto-reattaches data to their classes, based on AJV metadata\nexport const GetNodeTags = StoreAccessor(s=>(nodeID: string): MapNodeTag[]=>{\n\treturn GetDocs({\n\t\t//filters: [new WhereFilter(`nodes.${nodeID}`, \">\", \"\")], // `if value > \"\"` means \"if key exists\"\n\t\tfilters: [new WhereFilter(`nodes`, \"array-contains\", nodeID)],\n\t}, a=>a.nodeTags);\n});\nexport const GetNodeTag = StoreAccessor(s=>(tagID: string): MapNodeTag=>{\n\treturn GetDoc({}, a=>a.nodeTags.get(tagID));\n});\n\nexport const GetNodeTagComps = StoreAccessor(s=>(nodeID: string, unwrapCompositeTags = true, tagsToIgnore?: string[]): TagComp[]=>{\n\tconst tags = GetNodeTags(nodeID);\n\tif (tags == emptyArray_forLoading) return emptyArray_forLoading;\n\treturn CE(tags).SelectMany(tag=>{\n\t\tif (tagsToIgnore?.includes(tag._key)) return [];\n\t\tconst baseComp = GetTagCompOfTag(tag);\n\t\treturn unwrapCompositeTags ? GetFinalTagCompsForTag(tag) : [baseComp];\n\t});\n});\nexport const GetFinalTagCompsForTag = StoreAccessor(s=>(tag: MapNodeTag): TagComp[]=>{\n\tconst compClass = GetTagCompClassByTag(tag);\n\tconst comp = GetTagCompOfTag(tag);\n\t//return comp.As(compClass).GetFinalTagComps();\n\treturn compClass.prototype.GetFinalTagComps.call(comp);\n});","import {CachedTransform, emptyArray_forLoading, ToNumber, CE, ObjectCE} from \"js-vextensions\";\nimport {GetDoc, GetDocs, StoreAccessor} from \"mobx-firelink\";\nimport {Map, MapType} from \"./maps/@Map\";\n\nexport const GetMaps = StoreAccessor(s=>(orderByEdits = false): Map[]=>{\n\t/* const mapsMap = GetData({ collection: true }, 'maps');\n\treturn CachedTransform('GetMaps', [], mapsMap, () => (mapsMap ? mapsMap.VValues(true) : [])); */\n\tconst mapsMap = GetDocs({}, a=>a.maps);\n\tif (!mapsMap) return emptyArray_forLoading;\n\tlet result = ObjectCE(mapsMap).VValues();\n\tif (orderByEdits) result = CE(result).OrderByDescending(a=>ToNumber(a && a.edits, 0));\n\treturn result;\n});\nexport const GetMaps_Private = StoreAccessor(s=>(orderByEdits = false)=>{\n\treturn GetMaps(orderByEdits).filter(a=>a && a.type == MapType.Private);\n});\nexport const GetMaps_Public = StoreAccessor(s=>(orderByEdits = false)=>{\n\treturn GetMaps(orderByEdits).filter(a=>a && a.type == MapType.Public);\n});\n\n/* export function GetMapsOfType(type: MapType): Map[] {\n\tconst mapsMap = GetData({ collection: true }, 'maps');\n\treturn CachedTransform('GetMaps', [type], mapsMap, () => (mapsMap ? mapsMap.VValues(true).filter(a => a && a.type == type) : []));\n} */\nexport const GetMap = StoreAccessor(s=>(id: string): Map=>{\n\treturn GetDoc({}, a=>a.maps.get(id));\n});","import \"mobx\"; // import mobx before we declare the module below, otherwise vscode auto-importer gets confused at path to mobx\nimport {Firelink, GetDoc, SetDefaultFireOptions, StoreAccessorOptions} from \"mobx-firelink\";\nimport {RootStoreShape} from \"mobx-firelink/Dist/UserTypes\";\nimport {FirebaseDBShape} from \"./Store/firebase\";\n\ndeclare module \"mobx-firelink/Dist/UserTypes\" {\n\t//interface RootStoreShape extends RootState {}\n\tinterface DBShape extends FirebaseDBShape {}\n}\n\nexport const fire = new Firelink<RootStoreShape, FirebaseDBShape>();\n//store.firelink = fire;\nSetDefaultFireOptions({fire});\n// console.log('Default fire options set:', { fire });\n//OnPopulated(()=>fire.InitSubs());\n\nexport function InitFirelink(rootPathInDB: string, rootStore: any) {\n\t//const linkRootPath = `versions/v${dbVersion}-${DB_SHORT}`;\n\tfire.Initialize({rootPathInDB, rootStore});\n\n\t// start auto-runs after store+firelink are created\n\t//require(\"./Utils/AutoRuns\");\n}\n\n// modify some default options\n// StoreAccessorOptions.default.cache_keepAlive = true;\n\n// mobx debug helper\n// ==========\n\n/* window['mobxDevtools_processChange'] = (change) => {\n\t// change.rootStoreData = store;\n\t/* change.mapViews = store.main.mapViews['raw'];\n\tchange.mapViews._sendFull = true; *#/\n\tchange.mapViews = { _serialize() {\n\t\t// return store.main.mapViews['raw'];\n\t\treturn Clone(store.main.mapViews['raw']);\n\t} };\n}; */","import {ObservableMap} from \"mobx\";\nimport {Collection_Closed, Collection, StoreAccessor} from \"mobx-firelink\";\nimport {GeneralData} from \"./firebase/general\";\nimport {Image} from \"./firebase/images/@Image\";\nimport {Layer} from \"./firebase/layers/@Layer\";\nimport {NodeEditTimes} from \"./firebase/mapNodeEditTimes\";\nimport {Map} from \"./firebase/maps/@Map\";\nimport {MapNodePhrasing} from \"./firebase/nodePhrasings/@MapNodePhrasing\";\nimport {MapNode} from \"./firebase/nodes/@MapNode\";\nimport {MapNodeRevision} from \"./firebase/nodes/@MapNodeRevision\";\nimport {Term} from \"./firebase/terms/@Term\";\nimport {Timeline} from \"./firebase/timelines/@Timeline\";\nimport {TimelineStep} from \"./firebase/timelineSteps/@TimelineStep\";\nimport {UserMapInfoSet} from \"./firebase/userMapInfo/@UserMapInfo\";\nimport {User} from \"./firebase/users/@User\";\nimport {User_Private} from \"./firebase/users_private/@User_Private\";\nimport {MapNodeTag} from \"./firebase/nodeTags/@MapNodeTag\";\nimport {fire} from \"../MobXFirelink\";\nimport {Rating} from \"./firebase/nodeRatings/@Rating\";\n\n// manually import these, since otherwise they're never runtime-imported\nrequire(\"./firebase/users_private/@User_Private\");\n\nexport interface FirebaseDBShape {\n\tgeneral: Collection_Closed<{data: GeneralData}>;\n\tmodules: Collection_Closed<{\n\t\t// feedback: FeedbackDBShape;\n\t}>;\n\n\timages: Collection<Image>;\n\tlayers: Collection<Layer>;\n\tmaps: Collection<Map>;\n\tmapNodeEditTimes: Collection<NodeEditTimes>;\n\tnodes: Collection<MapNode>;\n\t// nodeExtras: Collection<any>;\n\tnodeRatings: Collection<Rating>;\n\tnodeRevisions: Collection<MapNodeRevision>;\n\t// nodeStats: Collection<MapNodeStats>;\n\t// nodeViewers: Collection<ViewerSet>; // removed due to privacy concerns\n\tnodePhrasings: Collection<MapNodePhrasing>;\n\tnodeTags: Collection<MapNodeTag>;\n\tterms: Collection<Term>;\n\ttermNames: Collection<any>;\n\ttimelines: Collection<Timeline>;\n\ttimelineSteps: Collection<TimelineStep>;\n\tusers: Collection<User>;\n\tusers_private: Collection<User_Private>;\n\tuserMapInfo: Collection<UserMapInfoSet>; // $userID (key) -> $mapID -> layerStates -> $layerID -> [boolean, for whether enabled]\n\t// userViewedNodes: Collection<ViewedNodeSet>; // removed due to privacy concerns\n}\n\n/* export interface FirebaseDBShape {\n\tmodules: Collection_Closed<{\n\t\t// feedback: FeedbackDBShape;\n\t}>;\n\n\tgeneral: Collection_Closed<{data: GeneralData}>;\n\timages: Collection<Image>;\n\tlayers: Collection<Layer>;\n\tmaps: Collection<Map, {\n\t\tnodeEditTimes: Collection<NodeEditTimes>,\n\t}>;\n\tnodes: Collection<MapNode, {\n\t\tratings: Collection<RatingsRoot>, // $ratingType -> $userID -> value -> $value\n\t\t// extras: Collection<any>,\n\t\trevisions: Collection<MapNodeRevision>,\n\t\t// stats: Collection<MapNodeStats>,\n\t\t// viewers: Collection<ViewerSet>, // removed due to privacy concerns\n\t\tphrasings: Collection<MapNodePhrasing>,\n\t}>;\n\tterms: Collection<Term, {\n\t\tcomponents: Collection<TermComponent>,\n\t\tnames: Collection<any>,\n\t}>;\n\ttimelines: Collection<Timeline, {\n\t\tsteps: Collection<TimelineStep>,\n\t}>;\n\tusers: Collection<User, {\n\t\textras: Collection<UserExtraInfo>,\n\t\tmapInfo: Collection<UserMapInfoSet>, // $mapID -> layerStates -> $layerID -> [boolean, for whether enabled]\n\t\t// viewedNodes: Collection<ViewedNodeSet>, // removed due to privacy concerns\n\t}>;\n} */\n\nexport const GetAuth = StoreAccessor(s=>()=>{\n\t//return s.firelink.userInfo;\n\treturn fire.userInfo;\n});\nexport const GetAuth_Raw = StoreAccessor(s=>()=>{\n\t//return s.firelink.userInfo_raw;\n\treturn fire.userInfo_raw as any;\n});","import {GetDoc, GetDocs, IsAuthValid, StoreAccessor} from \"mobx-firelink\";\nimport {GetAuth} from \"../firebase\";\nimport {User} from \"./users/@User\";\n\n/* export function GetAuth(state: RootState) {\n\treturn state.firebase.auth;\n} */\nexport const MeID = StoreAccessor(s=>(): string=>{\n\t// return state.firebase.data.auth ? state.firebase.data.auth.uid : null;\n\t// return GetData(state.firebase, \"auth\");\n\t/* var result = helpers.pathToJS(firebase, \"auth\").uid;\n\treturn result; */\n\t/* let firebaseSet = State().firebase as Set<any>;\n\treturn firebaseSet.toJS().auth.uid; */\n\t// return State(a=>a.firebase.auth) ? State(a=>a.firebase.auth.uid) : null;\n\treturn IsAuthValid(GetAuth()) ? GetAuth().id : null;\n});\nexport const Me = StoreAccessor(s=>()=>{\n\treturn GetUser(MeID());\n});\n\nexport const GetUser = StoreAccessor(s=>(userID: string): User=>{\n\treturn GetDoc({}, a=>a.users.get(userID));\n});\nexport const GetUsers = StoreAccessor(s=>(): User[]=>{\n\treturn GetDocs({}, a=>a.users);\n});","import {Assert, IsString} from \"js-vextensions\";\nimport {StoreAccessor} from \"mobx-firelink\";\nimport {GetMap} from \"../maps\";\nimport {MapNodePhrasing} from \"../nodePhrasings/@MapNodePhrasing\";\nimport {GetNodeL2} from \"../nodes/$node\";\nimport {AccessLevel, MapNode} from \"../nodes/@MapNode\";\nimport {PermissionInfoType} from \"../nodes/@MapNodeRevision\";\nimport {Term} from \"../terms/@Term\";\nimport {Timeline} from \"../timelines/@Timeline\";\nimport {GetUser} from \"../users\";\nimport {GetUser_Private} from \"../users_private\";\nimport {Image} from \"../images/@Image\";\nimport {Map} from \"../maps/@Map\";\nimport {PermissionGroupSet} from \"./@User\";\n\n// permissions\n// ==========\n\n/*export const GetUserJoinDate = StoreAccessor(s=>(userID: string): number=>{\n\treturn GetUser(userID)?.joinDate;\n});*/\nconst defaultPermissions = {basic: true, verified: true, mod: false, admin: false} as PermissionGroupSet; // temp\nexport const GetUserPermissionGroups = StoreAccessor(s=>(userID: string): PermissionGroupSet=>{\n\tif (userID == null) return null;\n\treturn GetUser(userID)?.permissionGroups ?? defaultPermissions;\n});\nexport function GetUserAccessLevel(userID: string) {\n\tconst groups = GetUserPermissionGroups(userID);\n\tif (groups == null) return AccessLevel.Basic;\n\n\tif (groups.admin) return AccessLevel.Admin;\n\tif (groups.mod) return AccessLevel.Mod;\n\tif (groups.verified) return AccessLevel.Verified;\n\t// if (groups.basic) return AccessLevel.Basic;\n\tAssert(false);\n}\n\nexport const CanGetBasicPermissions = StoreAccessor(s=>(userIDOrPermissions: string | PermissionGroupSet)=>{\n\t// if (true) return HasModPermissions(userIDOrPermissions); // temp; will be removed once GAD is over\n\n\tconst permissions = IsString(userIDOrPermissions) ? GetUserPermissionGroups(userIDOrPermissions) : userIDOrPermissions;\n\treturn permissions == null || permissions.basic; // if anon/not-logged-in, assume user can get basic permissions once logged in\n});\nexport const HasBasicPermissions = StoreAccessor(s=>(userIDOrPermissions: string | PermissionGroupSet)=>{\n\t// if (true) return HasModPermissions(userIDOrPermissions); // temp; will be removed once GAD is over\n\n\tconst permissions = IsString(userIDOrPermissions) ? GetUserPermissionGroups(userIDOrPermissions) : userIDOrPermissions;\n\treturn permissions ? permissions.basic : false;\n});\nexport const HasModPermissions = StoreAccessor(s=>(userIDOrPermissions: string | PermissionGroupSet)=>{\n\tconst permissions = IsString(userIDOrPermissions) ? GetUserPermissionGroups(userIDOrPermissions) : userIDOrPermissions;\n\treturn permissions ? permissions.mod : false;\n});\nexport const HasAdminPermissions = StoreAccessor(s=>(userIDOrPermissions: string | PermissionGroupSet)=>{\n\tconst permissions = IsString(userIDOrPermissions) ? GetUserPermissionGroups(userIDOrPermissions) : userIDOrPermissions;\n\treturn permissions ? permissions.admin : false;\n});\n/** If user is the creator, also requires that they (still) have basic permissions. */\n//export const IsUserCreatorOrMod = StoreAccessor(s=>(userID: string, entity: Term | Image | Map | MapNode | MapNodePhrasing | Timeline /* | Post | Thread */)=>{\nexport const IsUserCreatorOrMod = StoreAccessor(s=>(userID: string, entity: {creator?: string})=>{\n\treturn (entity && entity.creator === userID && HasBasicPermissions(userID)) || HasModPermissions(userID);\n});\n\nexport const CanEditNode = StoreAccessor(s=>(userID: string, nodeID: string): boolean=>{\n\t// mods and admins can always edit\n\tif (HasModPermissions(userID) || HasAdminPermissions(userID)) {\n\t\treturn true;\n\t}\n\n\t/* let user = GetUser(userID);\n\tif (user == null) return false; */\n\tconst node = GetNodeL2(nodeID);\n\tif (node == null) return false;\n\tconst revision = node.current;\n\n\t// probably temp\n\tconst editPerm = revision.permission_edit ?? {type: PermissionInfoType.Anyone};\n\n\tif (editPerm.type == PermissionInfoType.Anyone) {\n\t\treturn CanGetBasicPermissions(userID);\n\t}\n\tif (editPerm.type == PermissionInfoType.Creator) {\n\t\treturn revision.creator == userID;\n\t}\n\tif (editPerm.type == PermissionInfoType.MapEditors) {\n\t\tif (revision.creator == userID) return true; // node-creator can always edit\n\t\tconst map = GetMap(node.ownerMapID);\n\t\treturn map?.editorIDs?.includes(userID) ?? false;\n\t}\n\tAssert(false, \"Invalid permission-info-type.\");\n});\n\nexport const CanContributeToNode = StoreAccessor(s=>(userID: string, nodeID: string): boolean=>{\n\t// mods and admins can always contribute\n\tif (HasModPermissions(userID) || HasAdminPermissions(userID)) {\n\t\treturn true;\n\t}\n\n\t/* let user = GetUser(userID);\n\tif (user == null) return false; */\n\tconst node = GetNodeL2(nodeID);\n\tif (node == null) return false;\n\tconst revision = node.current;\n\n\t// probably temp\n\tconst contributePerm = revision.permission_contribute ?? {type: PermissionInfoType.Anyone};\n\n\tif (contributePerm.type == PermissionInfoType.Anyone) {\n\t\treturn CanGetBasicPermissions(userID);\n\t}\n\tif (contributePerm.type == PermissionInfoType.Creator) {\n\t\treturn revision.creator == userID;\n\t}\n\tif (contributePerm.type == PermissionInfoType.MapEditors) {\n\t\tif (revision.creator == userID) return true; // node-creator can always contribute\n\t\tconst map = GetMap(node.ownerMapID);\n\t\treturn map?.editorIDs?.includes(userID) ?? false;\n\t}\n\tAssert(false, \"Invalid permission-info-type.\");\n});","import {Assert, CachedTransform, GetValues, IsString, VURL, E, Clone, CE} from \"js-vextensions\";\nimport {SplitStringBySlash_Cached, SlicePath, StoreAccessor} from \"mobx-firelink\";\nimport {GetImage} from \"../images\";\nimport {GetNiceNameForImageType} from \"../images/@Image\";\nimport {RatingType} from \"../nodeRatings/@RatingType\";\nimport {GetNodeRevision} from \"../nodeRevisions\";\nimport {ForLink_GetError, ForNewLink_GetError, GetNode, GetNodeChildrenL2, GetNodeID, GetParentNode, GetParentNodeL2, HolderType, IsNodeSubnode, GetNodeChildrenL3} from \"../nodes\";\nimport {ChildEntry, ClaimForm, MapNode, MapNodeL2, MapNodeL3, Polarity} from \"./@MapNode\";\nimport {MapNodeRevision, TitlesMap, TitleKey_values} from \"./@MapNodeRevision\";\nimport {MapNodeType} from \"./@MapNodeType\";\nimport {PermissionGroupSet} from \"../users/@User\";\nimport {GetNodeTags, GetNodeTagComps, GetFinalTagCompsForTag} from \"../nodeTags\";\nimport {CanContributeToNode} from \"../users/$user\";\nimport {TagComp_MirrorChildrenFromXToY} from \"../nodeTags/@MapNodeTag\";\n\nexport function PreProcessLatex(text: string) {\n\t// text = text.replace(/\\\\term{/g, \"\\\\text{\");\n\t// \"\\term{some-term}{123}\" -> \"\\text{@term[some-term,123]}\n\t//text = text.replace(/\\\\term{(.+?)}{([A-Za-z0-9_-]+?)}/g, (m, g1, g2)=>`\\\\text{@term[${g1},${g2}]}`);\n\n\t// \"\\term{some-term}\" -> \"\\text{@term[some-term]}\n\ttext = text.replace(/\\\\term{(.+?)}/g, (m, g1, g2)=>`\\\\text{@term[${g1}]}`);\n\n\ttext = text.replace(/\\\\term/g, ()=>\"[syntax wrong]\"); // for user syntax mistakes, keep from causing error\n\treturn text;\n}\n\nexport function GetFontSizeForNode(node: MapNodeL2, isSubnode = false) {\n\tif (node.current.fontSizeOverride) return node.current.fontSizeOverride;\n\tif (node.current.equation) return node.current.equation.latex ? 14 : 13;\n\tif (isSubnode) return 11;\n\treturn 14;\n}\nexport function GetPaddingForNode(node: MapNodeL2, isSubnode = false) {\n\treturn isSubnode ? \"1px 4px 2px\" : \"5px 5px 4px\";\n}\nexport type RatingTypeInfo = {type: RatingType, main?: boolean, collapsed?: boolean};\nexport function GetRatingTypesForNode(node: MapNodeL2): RatingTypeInfo[] {\n\tif (node.type == MapNodeType.Category) {\n\t\tif (node.current.votingDisabled) return [];\n\t\treturn [{type: \"significance\", main: true}];\n\t}\n\tif (node.type == MapNodeType.Package) {\n\t\treturn [{type: \"significance\", main: true}];\n\t}\n\tif (node.type == MapNodeType.MultiChoiceQuestion) {\n\t\treturn [{type: \"significance\", main: true}];\n\t}\n\tif (node.type == MapNodeType.Claim) {\n\t\tlet result: RatingTypeInfo[];\n\t\t// result = [{type: \"truth\", main: true}]; //, {type: \"significance\", main: true}];\n\t\tresult = [{type: \"truth\", main: true}]; // , {type: \"relevance\", main: true}];\n\t\t/* if ((node as MapNodeL2).link && (node as MapNodeL2).link.form == ClaimForm.YesNoQuestion) {\n\t\t\tresult.Remove(result.First(a=>a.type == \"significance\"));\n\t\t\tresult.Insert(0, {type: \"significance\", main: true});\n\t\t} */\n\t\treturn result;\n\t}\n\tif (node.type == MapNodeType.Argument) {\n\t\t// return [{type: \"strength\", main: true}, {type: \"impact\", main: true}];\n\t\treturn [{type: \"relevance\"}, {type: \"impact\", main: true}];\n\t}\n\tAssert(false);\n}\nexport const GetMainRatingType = StoreAccessor(s=>(node: MapNodeL2)=>{\n\treturn CE(GetRatingTypesForNode(node)).FirstOrX(a=>a.main, {}).type;\n});\nexport function GetSortByRatingType(node: MapNodeL3): RatingType {\n\tif (node.link && node.link.form == ClaimForm.YesNoQuestion) {\n\t\treturn \"significance\";\n\t}\n\treturn GetMainRatingType(node);\n}\n\nexport function ReversePolarity(polarity: Polarity) {\n\treturn polarity == Polarity.Supporting ? Polarity.Opposing : Polarity.Supporting;\n}\nexport const GetDisplayPolarityAtPath = StoreAccessor(s=>(node: MapNodeL2, path: string, tagsToIgnore?: string[]): Polarity=>{\n\tAssert(node.type == MapNodeType.Argument, \"Only argument nodes have polarity.\");\n\tconst parent = GetParentNodeL2(path);\n\tif (!parent) return Polarity.Supporting; // can be null, if for NodeUI_ForBots\n\n\tconst link = GetLinkUnderParent(node._key, parent, true, tagsToIgnore);\n\tif (link == null) return Polarity.Supporting; // can be null, if path is invalid (eg. copied-node path)\n\tAssert(link.polarity != null, `The link for the argument #${node._key} (from parent #${parent._key}) must specify the polarity.`);\n\n\tconst parentForm = GetNodeForm(parent, SplitStringBySlash_Cached(path).slice(0, -1).join(\"/\"));\n\treturn GetDisplayPolarity(link.polarity, parentForm);\n});\nexport function GetDisplayPolarity(basePolarity: Polarity, parentForm: ClaimForm): Polarity {\n\tlet result = basePolarity;\n\tif (parentForm == ClaimForm.Negation) {\n\t\tresult = ReversePolarity(result);\n\t}\n\treturn result;\n}\nexport function IsNodeL1(node): node is MapNode {\n\treturn !node[\"current\"];\n}\nexport function AsNodeL1(node: MapNodeL2 | MapNodeL3) {\n\tconst result = E(node);\n\tdelete result.current;\n\tdelete result[\"displayPolarity\"];\n\tdelete result[\"link\"];\n\treturn result as MapNode;\n}\n\nexport function IsNodeL2(node: MapNode): node is MapNodeL2 {\n\treturn node[\"current\"];\n}\nexport function AsNodeL2(node: MapNode, currentRevision: MapNodeRevision) {\n\t// Assert(currentRevision.titles, \"A MapNodeRevision object must have a titles property!\"); // temp removed (for db-upgrade)\n\tconst result = E(node, {current: currentRevision}) as MapNodeL2;\n\tdelete result[\"displayPolarity\"];\n\tdelete result[\"link\"];\n\treturn result;\n}\nexport const GetNodeL2 = StoreAccessor(s=>(nodeID: string | MapNode, path?: string)=>{\n\tif (IsString(nodeID)) nodeID = GetNode(nodeID);\n\tif (nodeID == null) return null;\n\tconst node = nodeID as MapNode;\n\n\t// if any of the data in a MapNodeL2 is not loaded yet, just return null (we want it to be all or nothing)\n\tconst currentRevision = GetNodeRevision(node.currentRevision);\n\tif (currentRevision === undefined) return undefined;\n\n\tconst nodeL2 = AsNodeL2(node, currentRevision);\n\t//return CachedTransform(\"GetNodeL2\", [path], nodeL2, ()=>nodeL2);\n\treturn nodeL2;\n});\n\nexport function IsNodeL3(node: MapNode): node is MapNodeL3 {\n\treturn node[\"displayPolarity\"] && node[\"link\"];\n}\nexport function AsNodeL3(node: MapNodeL2, displayPolarity?: Polarity, link?: ChildEntry) {\n\tdisplayPolarity = displayPolarity || Polarity.Supporting;\n\tlink = link || {\n\t\t_: true,\n\t\tform: ClaimForm.Base,\n\t\tseriesAnchor: false,\n\t\tpolarity: Polarity.Supporting,\n\t};\n\treturn E(node, {displayPolarity, link}) as MapNodeL3;\n}\nexport const GetNodeL3 = StoreAccessor(s=>(path: string, tagsToIgnore?: string[])=>{\n\tif (path == null) return null;\n\tconst nodeID = GetNodeID(path);\n\tconst node = GetNodeL2(nodeID);\n\tif (node == null) return null;\n\n\t// if any of the data in a MapNodeL3 is not loaded yet, just return null (we want it to be all or nothing)\n\tlet displayPolarity = null;\n\tif (node.type == MapNodeType.Argument) {\n\t\tdisplayPolarity = GetDisplayPolarityAtPath(node, path, tagsToIgnore);\n\t\tif (displayPolarity == null) return null;\n\t}\n\n\tconst isSubnode = IsNodeSubnode(node);\n\tif (!isSubnode) {\n\t\tconst parent = GetParentNode(path);\n\t\tif (parent == null && path.includes(\"/\")) return null;\n\t\tvar link = GetLinkUnderParent(node._key, parent, true, tagsToIgnore);\n\t\tif (link == null && path.includes(\"/\")) return null;\n\t}\n\n\tconst nodeL3 = AsNodeL3(node, displayPolarity, link);\n\t// return CachedTransform('GetNodeL3', [path], nodeL3, () => nodeL3);\n\treturn nodeL3;\n});\n\n/* export function GetNodeForm(node: MapNode, path: string): ClaimForm {\n\tlet parent = GetParentNode(path);\n\treturn GetNodeForm(node, parent);\n}\nexport function GetClaimFormUnderParent(node: MapNode, parent: MapNode): ClaimForm {\n\tlet link = GetLinkUnderParent(node._id, parent);\n\tif (link == null) return ClaimForm.Base;\n\treturn link.form;\n} */\nexport const GetNodeForm = StoreAccessor(s=>(node: MapNodeL2 | MapNodeL3, pathOrParent?: string | MapNodeL2): ClaimForm=>{\n\tif (IsNodeL3(node)) {\n\t\treturn node.link.form;\n\t}\n\n\tconst parent: MapNodeL2 = IsString(pathOrParent) ? GetParentNodeL2(pathOrParent as string) : pathOrParent as MapNodeL2;\n\tconst link = GetLinkUnderParent(node._key, parent);\n\tif (link == null) return ClaimForm.Base;\n\treturn link.form;\n});\nexport const GetLinkUnderParent = StoreAccessor(s=>(nodeID: string, parent: MapNode, includeMirrorLinks = true, tagsToIgnore?: string[]): ChildEntry=>{\n\tif (parent == null) return null;\n\tlet link = parent.children?.[nodeID]; // null-check, since after child-delete, parent-data might have updated before child-data removed\n\tif (includeMirrorLinks && link == null) {\n\t\tlet tags = GetNodeTags(parent._key).filter(tag=>tag && !tagsToIgnore?.includes(tag._key));\n\t\tfor (const tag of tags) {\n\t\t\t//let tagComps = GetNodeTagComps(parent._key);\n\t\t\tconst tagComps = GetFinalTagCompsForTag(tag);\n\t\t\tfor (const comp of tagComps) {\n\t\t\t\tif (comp instanceof TagComp_MirrorChildrenFromXToY && comp.nodeY == parent._key) {\n\t\t\t\t\tlet mirrorChildren = GetNodeChildrenL3(comp.nodeX, undefined, undefined, (tagsToIgnore ?? []).concat(tag._key));\n\t\t\t\t\tmirrorChildren = mirrorChildren.filter(child=> {\n\t\t\t\t\t\treturn child && ((child.link.polarity == Polarity.Supporting && comp.mirrorSupporting) || (child.link.polarity == Polarity.Opposing && comp.mirrorOpposing));\n\t\t\t\t\t});\n\t\t\t\t\tlet nodeL3ForNodeAsMirrorChildInThisTag = mirrorChildren.find(a=>a._key == nodeID);\n\t\t\t\t\t//const nodeL3ForNodeAsMirrorChildInThisTag = GetNodeL3(`${comp.nodeX}/${nodeID}`);\n\t\t\t\t\tif (nodeL3ForNodeAsMirrorChildInThisTag) {\n\t\t\t\t\t\tlink = Clone(nodeL3ForNodeAsMirrorChildInThisTag.link);\n\t\t\t\t\t\tObject.defineProperty(link, \"_mirrorLink\", {value: true});\n\t\t\t\t\t\tif (comp.reversePolarities) {\n\t\t\t\t\t\t\tlink.polarity = ReversePolarity(link.polarity);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn link;\n});\nexport function GetLinkAtPath(path: string) {\n\tconst nodeID = GetNodeID(path);\n\tconst parent = GetNode(GetNodeID(SlicePath(path, 1)));\n\treturn GetLinkUnderParent(nodeID, parent);\n}\n\nexport class NodeContributionInfo {\n\tconstructor(nodeID: string) {\n\t\tthis.proArgs = new NodeContributionInfo_ForPolarity(nodeID);\n\t\tthis.conArgs = new NodeContributionInfo_ForPolarity(nodeID);\n\t}\n\tproArgs: NodeContributionInfo_ForPolarity;\n\tconArgs: NodeContributionInfo_ForPolarity;\n}\nexport class NodeContributionInfo_ForPolarity {\n\tconstructor(nodeID: string) {\n\t\tthis.hostNodeID = nodeID;\n\t}\n\tcanAdd = true;\n\thostNodeID: string;\n\treversePolarities = false;\n}\nexport function GetPolarityShortStr(polarity: Polarity) {\n\treturn polarity == Polarity.Supporting ? \"pro\" : \"con\";\n}\n\nexport const GetNodeContributionInfo = StoreAccessor(s=>(nodeID: string, userID: string)=> {\n\tlet result = new NodeContributionInfo(nodeID);\n\tlet tags = GetNodeTags(nodeID);\n\tlet directChildrenDisabled = CE(tags).Any(a=>a.mirrorChildrenFromXToY?.nodeY == nodeID && a.mirrorChildrenFromXToY?.disableDirectChildren);\n\tif (directChildrenDisabled) {\n\t\tresult.proArgs.canAdd = false;\n\t\tresult.conArgs.canAdd = false;\n\t}\n\tfor (let tag of tags) {\n\t\tif (tag.mirrorChildrenFromXToY && tag.mirrorChildrenFromXToY.nodeY == nodeID) {\n\t\t\tlet comp = tag.mirrorChildrenFromXToY;\n\t\t\tlet addForPolarities_short = [] as (\"pro\" | \"con\")[];\n\t\t\tif (comp.mirrorSupporting) addForPolarities_short.push(comp.reversePolarities ? \"con\" : \"pro\");\n\t\t\tif (comp.mirrorOpposing) addForPolarities_short.push(comp.reversePolarities ? \"pro\" : \"con\");\n\t\t\tfor (let polarity_short of addForPolarities_short) {\n\t\t\t\tresult[`${polarity_short}Args`].canAdd = true;\n\t\t\t\tresult[`${polarity_short}Args`].hostNodeID = comp.nodeX;\n\t\t\t\tresult[`${polarity_short}Args`].reversePolarities = comp.reversePolarities;\n\t\t\t}\n\t\t}\n\t}\n\tif (!CanContributeToNode(userID, result.proArgs.hostNodeID)) result.proArgs.canAdd = false;\n\tif (!CanContributeToNode(userID, result.conArgs.hostNodeID)) result.conArgs.canAdd = false;\n\treturn result;\n});\n\nexport function IsNodeTitleValid_GetError(node: MapNode, title: string) {\n\tif (title.trim().length == 0) return \"Title cannot be empty.\";\n\treturn null;\n}\n\nexport function GetAllNodeRevisionTitles(nodeRevision: MapNodeRevision): string[] {\n\tif (nodeRevision == null || nodeRevision.titles == null) return [];\n\treturn TitleKey_values.map(key=>nodeRevision.titles[key]).filter(a=>a != null);\n}\n\n/** Gets the main display-text for a node. (doesn't include equation explanation, quote sources, etc.) */\nexport const GetNodeDisplayText = StoreAccessor(s=>(node: MapNodeL2, path?: string, form?: ClaimForm): string=>{\n\tform = form || GetNodeForm(node, path);\n\tconst titles = node.current.titles || {} as TitlesMap;\n\n\t// if (path && path.split('/').length > 3) throw new Error('Test1'); // for testing node error-boundaries\n\n\tif (node.type == MapNodeType.Argument && !node.multiPremiseArgument && !titles.base) {\n\t\t// const baseClaim = GetNodeL2(node.children && node.children.VKeys().length ? node.children.VKeys()[0] : null);\n\t\t// const baseClaim = GetArgumentPremises(node)[0];\n\t\tconst baseClaim = GetNodeChildrenL2(node._key).filter(a=>a && a.type == MapNodeType.Claim)[0];\n\t\tif (baseClaim) return GetNodeDisplayText(baseClaim);\n\t}\n\tif (node.type == MapNodeType.Claim) {\n\t\tif (node.current.equation) {\n\t\t\tlet result = node.current.equation.text;\n\t\t\t//if (node.current.equation.latex && !isBot) {\n\t\t\tif (node.current.equation.latex && typeof window != \"undefined\" && window[\"katex\"] && window[\"$\"]) {\n\t\t\t\t// result = result.replace(/\\\\[^{]+/g, \"\").replace(/[{}]/g, \"\");\n\t\t\t\tconst latex = PreProcessLatex(result);\n\t\t\t\ttry {\n\t\t\t\t\tconst html = window[\"katex\"].renderToString(latex) as string;\n\t\t\t\t\tconst dom = window[\"$\"](html).children(\".katex-html\");\n\t\t\t\t\tresult = dom.text();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tif (ex.message.startsWith(\"KaTeX parse error: \")) {\n\t\t\t\t\t\treturn ex.message.replace(/^KaTeX/, \"LaTeX\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tif (node.current.quote) {\n\t\t\tconst firstSource = node.current.quote.sourceChains[0].sources[0];\n\t\t\t// if (PROD && firstSource == null) return '(first source is null)'; // defensive\n\t\t\treturn `The statement below was made${ // (as shown)\n\t\t\t\tfirstSource.name ? ` in \"${firstSource.name}\"` : \"\"}${\n\t\t\t\t\tfirstSource.author ? ` by ${firstSource.author}` : \"\"}${\n\t\t\t\t\t\tfirstSource.link ? ` at \"${VURL.Parse(firstSource.link, false).toString({domain_protocol: false})}\"` : \"\" // maybe temp\n\t\t\t}.`;\n\t\t}\n\t\tif (node.current.image) {\n\t\t\tconst image = GetImage(node.current.image.id);\n\t\t\tif (image == null) return \"...\";\n\t\t\t// if (image.sourceChains == null) return `The ${GetNiceNameForImageType(image.type)} below is unmodified.`; // temp\n\t\t\tconst firstSource = image.sourceChains[0].sources[0];\n\t\t\treturn `The ${GetNiceNameForImageType(image.type)} below was published${ // (as shown)`\n\t\t\t\tfirstSource.name ? ` in \"${firstSource.name}\"` : \"\"}${\n\t\t\t\t\tfirstSource.author ? ` by ${firstSource.author}` : \"\"}${\n\t\t\t\t\t\tfirstSource.link ? ` at \"${VURL.Parse(firstSource.link, false).toString({domain_protocol: false})}\"` : \"\" // maybe temp\n\t\t\t}.`;\n\t\t}\n\n\t\tif (form) {\n\t\t\tif (form == ClaimForm.Negation) return titles.negation || missingTitleStrings[1];\n\t\t\tif (form == ClaimForm.YesNoQuestion) return titles.yesNoQuestion || missingTitleStrings[2];\n\t\t}\n\t}\n\treturn titles.base || missingTitleStrings[0];\n});\nexport const missingTitleStrings = [\"(base title not set)\", \"(negation title not set)\", \"(question title not set)\"];\n\nexport function GetValidChildTypes(nodeType: MapNodeType, path: string) {\n\tconst nodeTypes = GetValues<MapNodeType>(MapNodeType);\n\tconst validChildTypes = nodeTypes.filter(type=>ForLink_GetError(nodeType, type) == null);\n\treturn validChildTypes;\n}\nexport function GetValidNewChildTypes(parent: MapNodeL2, holderType: HolderType, permissions: PermissionGroupSet) {\n\tconst nodeTypes = GetValues<MapNodeType>(MapNodeType);\n\tconst validChildTypes = nodeTypes.filter(type=>ForNewLink_GetError(parent._key, {type} as any, permissions, holderType) == null);\n\treturn validChildTypes;\n}\n\n/** Returns whether the node provided is an argument, and marked as single-premise. */\nexport const IsSinglePremiseArgument = StoreAccessor(s=>(node: MapNode)=>{\n\t/* nodeChildren = nodeChildren || GetNodeChildren(node);\n\tif (nodeChildren.Any(a=>a == null)) return null;\n\t//return nodeChildren.Any(child=>IsPremiseOfSinglePremiseArgument(child, node));\n\treturn node.type == MapNodeType.Argument && nodeChildren.filter(a=>a.type == MapNodeType.Claim).length == 1; */\n\treturn node && node.type == MapNodeType.Argument && !node.multiPremiseArgument;\n});\n/** Returns whether the node provided is an argument, and marked as multi-premise. */\nexport const IsMultiPremiseArgument = StoreAccessor(s=>(node: MapNode)=>{\n\t/* nodeChildren = nodeChildren || GetNodeChildren(node);\n\tif (nodeChildren.Any(a=>a == null)) return null;\n\t//return node.type == MapNodeType.Argument && !IsSinglePremiseArgument(node, nodeChildren);\n\treturn node.type == MapNodeType.Argument && nodeChildren.filter(a=>a.type == MapNodeType.Claim).length > 1; */\n\treturn node && node.type == MapNodeType.Argument && node.multiPremiseArgument;\n});\n\nexport const IsPremiseOfSinglePremiseArgument = StoreAccessor(s=>(node: MapNode, parent: MapNode)=>{\n\tif (parent == null) return null;\n\t// let parentChildren = GetNodeChildrenL2(parent);\n\t/* if (parentChildren.Any(a=>a == null)) return false;\n\treturn node.type == MapNodeType.Claim && parentChildren.filter(a=>a.type == MapNodeType.Claim).length == 1 && node.link.form != ClaimForm.YesNoQuestion; */\n\t//let node = GetNode(nodeID);\n\treturn node.type == MapNodeType.Claim && IsSinglePremiseArgument(parent);\n});\nexport function IsPremiseOfMultiPremiseArgument(node: MapNode, parent: MapNode) {\n\tif (parent == null) return null;\n\t// let parentChildren = GetNodeChildrenL2(parent);\n\t//let node = GetNode(nodeID);\n\treturn node.type == MapNodeType.Claim && IsMultiPremiseArgument(parent);\n}","import {emptyArray, emptyArray_forLoading, IsNaN, CE, Assert} from \"js-vextensions\";\nimport {GetDoc, SlicePath, SplitStringBySlash_Cached, StoreAccessor, UUID} from \"mobx-firelink\";\nimport {GetNodeRevisionsByTitle} from \"./nodeRevisions\";\nimport {AsNodeL1, GetNodeL2, GetNodeL3, IsPremiseOfSinglePremiseArgument, IsSinglePremiseArgument} from \"./nodes/$node\";\nimport {globalRootNodeID, MapNode, MapNodeL2, MapNodeL3, Polarity} from \"./nodes/@MapNode\";\nimport {TitleKey} from \"./nodes/@MapNodeRevision\";\nimport {MapNodeType, MapNodeType_Info} from \"./nodes/@MapNodeType\";\nimport {GetFinalTagCompsForTag, GetNodeTagComps, GetNodeTags} from \"./nodeTags\";\nimport {TagComp_MirrorChildrenFromXToY, TagComp_RestrictMirroringOfX, TagComp_XIsExtendedByY} from \"./nodeTags/@MapNodeTag\";\nimport {MeID} from \"./users\";\nimport {CanGetBasicPermissions, GetUserAccessLevel, HasAdminPermissions, IsUserCreatorOrMod} from \"./users/$user\";\nimport {PermissionGroupSet} from \"./users/@User\";\n\nexport enum HolderType {\n\tTruth = 10,\n\tRelevance = 20,\n}\n\nexport function PathSegmentToNodeID(segment: string): UUID {\n\tif (segment.length == 22) return segment; // if raw UUID\n\tif (segment.length == 23) return segment.slice(1); // if UUID, but with marker at front (marking as subnode, I believe)\n\tAssert(false, \"Segment text is invalid.\");\n}\n\n/* export type NodeMap = ObservableMap<string, MapNode>;\nexport const GetNodeMap = StoreAccessor((s) => (): NodeMap => {\n\treturn GetDocs((a) => a.nodes);\n}); */\n/* export const GetNodes = StoreAccessor((s) => (): MapNode[] => {\n\t/* const nodeMap = GetNodeMap();\n\treturn CachedTransform('GetNodes', [], nodeMap, () => (nodeMap ? nodeMap.VValues(true) : [])); *#/\n\treturn GetDocs({}, (a) => a.nodes);\n});\nexport const GetNodesL2 = StoreAccessor((s) => (): MapNodeL2[] => {\n\tconst nodes = GetNodes();\n\treturn nodes.map((a) => GetNodeL2(a));\n}); */\n/* export function GetNodes_Enhanced(): MapNode[] {\n\tlet nodeMap = GetNodeMap();\n\treturn CachedTransform(\"GetNodes_Enhanced\", [], nodeMap, ()=>nodeMap ? nodeMap.VValues(true) : []);\n} */\nexport const GetNodesByIDs = StoreAccessor(s=>(ids: string[], emptyForLoading = true): MapNode[]=>{\n\tconst nodes = ids.map(id=>GetNode(id));\n\tif (emptyForLoading && CE(nodes).Any(a=>a == null)) return emptyArray_forLoading;\n\treturn nodes;\n});\nexport const GetNodesByTitle = StoreAccessor(s=>(title: string, titleKey: TitleKey): MapNode[]=>{\n\tlet nodeRevisions = GetNodeRevisionsByTitle(title, titleKey);\n\treturn nodeRevisions.map(a=>GetNode(a.node));\n});\n\nexport const GetNode = StoreAccessor(s=>(id: string)=>{\n\t// Assert(id != null && !IsNaN(id), \"Node-id cannot be null or NaN.\");\n\tif (id == null || IsNaN(id)) return null;\n\treturn GetDoc({}, a=>a.nodes.get(id));\n});\n/* export async function GetNodeAsync(id: string) {\n\treturn await GetDataAsync(\"nodes\", id) as MapNode;\n} */\n\nexport function GetParentCount(node: MapNode) {\n\treturn CE(node.parents || {}).VKeys().length;\n}\nexport function GetChildCount(node: MapNode) {\n\treturn CE(node.children || {}).VKeys().length;\n}\n\nexport function IsRootNode(node: MapNode) {\n\tif (IsNodeSubnode(node)) return false;\n\treturn node.type == MapNodeType.Category && GetParentCount(node) == 0;\n}\nexport function IsNodeSubnode(node: MapNode) {\n\treturn node.layerPlusAnchorParents != null;\n}\n\nexport function GetParentPath(childPath: string) {\n\tconst childPathNodes = SplitStringBySlash_Cached(childPath);\n\tif (childPathNodes.length == 1) return null;\n\treturn childPathNodes.slice(0, -1).join(\"/\");\n}\nexport function GetParentNodeID(path: string) {\n\tconst pathNodes = SplitStringBySlash_Cached(path);\n\tif (CE(pathNodes).Last()[0] == \"*\") return null;\n\tconst parentNodeStr = CE(pathNodes).XFromLast(1);\n\treturn parentNodeStr ? PathSegmentToNodeID(parentNodeStr) : null;\n}\n\nexport const GetParentNode = StoreAccessor(s=>(childPath: string)=>{\n\treturn GetNode(GetParentNodeID(childPath));\n});\nexport const GetParentNodeL2 = StoreAccessor(s=>(childPath: string)=>{\n\treturn GetNodeL2(GetParentNodeID(childPath));\n});\nexport const GetParentNodeL3 = StoreAccessor(s=>(childPath: string)=>{\n\treturn GetNodeL3(GetParentPath(childPath));\n});\nexport const GetNodeID = StoreAccessor(s=>(path: string)=>{\n\tconst ownNodeStr = CE(SplitStringBySlash_Cached(path)).LastOrX();\n\treturn ownNodeStr ? PathSegmentToNodeID(ownNodeStr) : null;\n});\n\nexport function CleanArray(array: any[], emptyArrayIfItemLoading = true) {\n\tif (emptyArrayIfItemLoading && CE(array).Any(a=>a === undefined)) return emptyArray_forLoading;\n\treturn array; \n}\n\nexport const GetNodeParents = StoreAccessor(s=>(nodeID: string, emptyForLoading = true)=>{\n\tlet node = GetNode(nodeID);\n\t//return GetNodesByIDs(CE(node.parents || {}).VKeys());\n\treturn CleanArray(CE(node.parents || {}).VKeys().map(id=>GetNode(id)), emptyForLoading);\n});\nexport const GetNodeParentsL2 = StoreAccessor(s=>(nodeID: string, emptyForLoading = true)=>{\n\treturn CleanArray(GetNodeParents(nodeID).map(parent=>(parent ? GetNodeL2(parent) : undefined)), emptyForLoading);\n});\nexport const GetNodeParentsL3 = StoreAccessor(s=>(nodeID: string, path: string, emptyForLoading = true)=>{\n\treturn CleanArray(GetNodeParents(nodeID).map(parent=>(parent ? GetNodeL3(SlicePath(path, 1)) : undefined)), emptyForLoading);\n});\n\nexport const GetNodeChildren = StoreAccessor(s=>(nodeID: string, includeMirrorChildren = true, tagsToIgnore?: string[], emptyForLoading = true): MapNode[]=>{\n\tlet node = GetNode(nodeID);\n\tif (node == null) return emptyArray;\n\t// special case, for demo map\n\tif (node.children && node.children[0] instanceof MapNode) {\n\t\treturn node.children as any;\n\t}\n\n\tlet result = CE(node.children || {}).VKeys().map(id=>GetNode(id));\n\tif (includeMirrorChildren) {\n\t\t//let tags = GetNodeTags(nodeID);\n\t\tlet tagComps = GetNodeTagComps(nodeID, tagsToIgnore);\n\t\t// maybe todo: have disable-direct-children merely stop you from adding new direct children, not hide existing ones\n\t\tif (CE(tagComps).Any(a=>a instanceof TagComp_MirrorChildrenFromXToY && a.nodeY == nodeID && a.disableDirectChildren)) {\n\t\t\tresult = [];\n\t\t}\n\t\tlet mirrorChildren = GetNodeMirrorChildren(nodeID, tagsToIgnore);\n\t\t// filter out duplicate children\n\t\tmirrorChildren = mirrorChildren.filter(mirrorChild=>!CE(result).Any(directChild=>directChild._key == mirrorChild._key));\n\t\tresult.push(...mirrorChildren);\n\t}\n\treturn CleanArray(result, emptyForLoading);\n});\nexport const GetNodeMirrorChildren = StoreAccessor(s=>(nodeID: string, tagsToIgnore?: string[], emptyForLoading = true)=> {\n\tlet tags = GetNodeTags(nodeID).filter(tag=>tag && !tagsToIgnore?.includes(tag._key));\n\t//let tagComps = GetNodeTagComps(nodeID, true, tagsToIgnore);\n\n\tlet result = [] as MapNode[];\n\tfor (const tag of tags) {\n\t\tconst tagComps = GetFinalTagCompsForTag(tag);\n\t\tfor (const tagComp of tagComps) {\n\t\t\tif (tagComp instanceof TagComp_MirrorChildrenFromXToY && tagComp.nodeY == nodeID) {\n\t\t\t\t//let comp = tag.mirrorChildrenFromXToY;\n\t\t\t\tlet mirrorChildrenL3 = GetNodeChildrenL3(tagComp.nodeX, undefined, undefined, (tagsToIgnore ?? []).concat(tag._key));\n\t\t\t\tmirrorChildrenL3 = mirrorChildrenL3.filter(child=> {\n\t\t\t\t\tif (child == null) return false;\n\t\t\t\t\tlet childTagComps = GetNodeTagComps(child._key, true, (tagsToIgnore ?? []).concat(tag._key));\n\t\t\t\t\tif (childTagComps == emptyArray_forLoading) return false; // don't include child until we're sure it's allowed to be mirrored\n\t\t\t\t\tconst mirroringBlacklisted = CE(childTagComps).Any(comp=> {\n\t\t\t\t\t\tif (!(comp instanceof TagComp_RestrictMirroringOfX)) return false;\n\t\t\t\t\t\treturn comp.blacklistAllMirrorParents || comp.blacklistedMirrorParents?.includes(nodeID);\n\t\t\t\t\t});\n\t\t\t\t\tif (mirroringBlacklisted) return false;\n\t\t\t\t\treturn (child.link.polarity == Polarity.Supporting && tagComp.mirrorSupporting) || (child.link.polarity == Polarity.Opposing && tagComp.mirrorOpposing);\n\t\t\t\t});\n\n\t\t\t\t/*if (comp.reversePolarities) {\n\t\t\t\t\tmirrorChildren = mirrorChildren.map(child=> {\n\t\t\t\t\t\tlet newChild = child;\n\t\t\t\t\t\tif (child.link.polarity) {\n\t\t\t\t\t\t\tnewChild = Clone(child).VSet({_key: child._key}) as MapNodeL3;\n\t\t\t\t\t\t\tnewChild.link.polarity = ReversePolarity(newChild.link.polarity);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn newChild;\n\t\t\t\t\t});\n\t\t\t\t}*/\n\t\t\t\tlet mirrorChildrenL1 = mirrorChildrenL3.map(childL3=>AsNodeL1(childL3));\n\t\t\t\tresult.push(...mirrorChildrenL1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// exclude any mirror-child which is an extension of (ie. wider/weaker than) another child (that is, if it's the Y of an \"X is extended by Y\" tag, between children) \n\tresult = result.filter(child=> {\n\t\tlet childTagComps = GetNodeTagComps(child._key, true, tagsToIgnore);\n\t\tconst extensionOfAnotherMirrorChild = CE(childTagComps).Any(comp=> {\n\t\t\tif (!(comp instanceof TagComp_XIsExtendedByY)) return false;\n\t\t\tlet childIsNodeY = comp.nodeY == child._key;\n\t\t\tif (!childIsNodeY) return false;\n\n\t\t\tlet nodeDirectChildren = GetNodeChildren(nodeID, false);\n\t\t\tlet otherChildIsNodeX = CE(nodeDirectChildren.concat(result)).Any(otherChild=>comp.nodeX == otherChild._key);\n\t\t\treturn otherChildIsNodeX;\n\t\t});\n\t\tif (extensionOfAnotherMirrorChild) return false;\n\n\t\tif (IsSinglePremiseArgument(child)) {\n\t\t\tlet childPremise = GetPremiseOfSinglePremiseArgument(child._key);\n\t\t\tif (childPremise) {\n\t\t\t\tlet childPremiseTagComps = GetNodeTagComps(childPremise._key, true, tagsToIgnore);\n\t\t\t\tconst premiseIsExtensionOfAnotherMirrorChildPremise = CE(childPremiseTagComps).Any(comp=> {\n\t\t\t\t\tif (!(comp instanceof TagComp_XIsExtendedByY)) return false;\n\t\t\t\t\tlet childPremiseIsNodeY = comp.nodeY == childPremise._key;\n\t\t\t\t\tif (!childPremiseIsNodeY) return false;\n\n\t\t\t\t\tlet nodeDirectChildren = GetNodeChildren(nodeID, false);\n\t\t\t\t\tlet otherChildPremiseIsNodeX = CE(nodeDirectChildren.concat(result)).Any(otherChild=>{\n\t\t\t\t\t\treturn IsSinglePremiseArgument(otherChild) && comp.nodeX == GetPremiseOfSinglePremiseArgument(otherChild._key)?._key;\n\t\t\t\t\t});\n\t\t\t\t\treturn otherChildPremiseIsNodeX;\n\t\t\t\t});\n\t\t\t\tif (premiseIsExtensionOfAnotherMirrorChildPremise) return false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n\n\t// filter out duplicate children\n\tresult = result.filter((node, index)=> {\n\t\tlet earlierNodes = result.slice(0, index);\n\t\treturn !CE(earlierNodes).Any(a=>a._key == node._key);\n\t});\n\n\treturn CleanArray(result, emptyForLoading);\n});\n\nexport const GetNodeChildrenL2 = StoreAccessor(s=>(nodeID: string, includeMirrorChildren = true, tagsToIgnore?: string[], emptyForLoading = true)=>{\n\tconst nodeChildren = GetNodeChildren(nodeID, includeMirrorChildren, tagsToIgnore);\n\tlet nodeChildrenL2 = nodeChildren.map(child=>(child ? GetNodeL2(child) : undefined));\n\treturn CleanArray(nodeChildrenL2, emptyForLoading);\n});\nexport const GetNodeChildrenL3 = StoreAccessor(s=>(nodeID: string, path?: string, includeMirrorChildren = true, tagsToIgnore?: string[], emptyForLoading = true): MapNodeL3[]=>{\n\tpath = path || nodeID;\n\n\tconst nodeChildrenL2 = GetNodeChildrenL2(nodeID, includeMirrorChildren, tagsToIgnore);\n\tlet nodeChildrenL3 = nodeChildrenL2.map(child=>(child ? GetNodeL3(`${path}/${child._key}`, tagsToIgnore) : undefined));\n\treturn CleanArray(nodeChildrenL3, emptyForLoading);\n});\n\nexport const GetPremiseOfSinglePremiseArgument = StoreAccessor(s=>(argumentNodeID: string)=>{\n\tlet argument = GetNode(argumentNodeID);\n\tlet children = GetNodeChildren(argumentNodeID, false);\n\tlet childPremise = children.find(child=>child && IsPremiseOfSinglePremiseArgument(child, argument));\n\treturn childPremise;\n});\n\nexport function GetHolderType(childType: MapNodeType, parentType: MapNodeType) {\n\tif (parentType == MapNodeType.Argument) {\n\t\tif (childType == MapNodeType.Argument) return HolderType.Relevance;\n\t} else if (parentType == MapNodeType.Claim) {\n\t\tif (childType == MapNodeType.Argument) return HolderType.Truth;\n\t}\n\treturn null;\n}\n\nexport const ForLink_GetError = StoreAccessor(s=>(parentType: MapNodeType, childType: MapNodeType)=>{\n\tconst parentTypeInfo = MapNodeType_Info.for[parentType].childTypes;\n\tif (!parentTypeInfo?.includes(childType)) return `The child's type (${MapNodeType[childType]}) is not valid for the parent's type (${MapNodeType[parentType]}).`;\n});\nexport const ForNewLink_GetError = StoreAccessor(s=>(parentID: string, newChild: Pick<MapNode, \"_key\" | \"type\">, permissions: PermissionGroupSet, newHolderType?: HolderType)=>{\n\tif (!CanGetBasicPermissions(permissions)) return \"You're not signed in, or lack basic permissions.\";\n\tconst parent = GetNode(parentID);\n\tif (parent == null) return \"Parent data not found.\";\n\t// const parentPathIDs = SplitStringBySlash_Cached(parentPath).map(a => a.ToInt());\n\t// if (map.name == \"Global\" && parentPathIDs.length == 1) return false; // if parent is l1(root), don't accept new children\n\tif (parent._key == globalRootNodeID && !HasAdminPermissions(permissions)) return \"Only admins can add children to the global-root.\";\n\t// if in global map, parent is l2, and user is not a mod (and not node creator), don't accept new children\n\t// if (parentPathIDs[0] == globalRootNodeID && parentPathIDs.length == 2 && !HasModPermissions(permissions) && parent.creator != MeID()) return false;\n\tif (parent._key == newChild._key) return \"Cannot link node as its own child.\";\n\n\tconst isAlreadyChild = CE(parent.children || {}).VKeys().includes(`${newChild._key}`);\n\t// if new-holder-type is not specified, consider \"any\" and so don't check\n\tif (newHolderType !== undefined) {\n\t\tconst currentHolderType = GetHolderType(newChild.type, parent.type);\n\t\tif (isAlreadyChild && currentHolderType == newHolderType) return false; // if already a child of this parent, reject (unless it's a claim, in which case allow, as can be)\n\t}\n\treturn ForLink_GetError(parent.type, newChild.type);\n});\n\nexport const ForDelete_GetError = StoreAccessor(s=>(userID: string, node: MapNodeL2, subcommandInfo?: {asPartOfMapDelete?: boolean, parentsToIgnore?: string[], childrenToIgnore?: string[]})=>{\n\tconst baseText = `Cannot delete node #${node._key}, since `;\n\tif (!IsUserCreatorOrMod(userID, node)) return `${baseText}you are not the owner of this node. (or a mod)`;\n\tif (CE(CE(node.parents || {}).VKeys()).Except(...subcommandInfo?.parentsToIgnore ?? []).length > 1) return `${baseText}it has more than one parent. Try unlinking it instead.`;\n\tif (IsRootNode(node) && !subcommandInfo?.asPartOfMapDelete) return `${baseText}it's the root-node of a map.`;\n\n\tconst nodeChildren = GetNodeChildrenL2(node._key);\n\tif (CE(nodeChildren).Any(a=>a == null)) return \"[still loading children...]\";\n\tif (CE(nodeChildren.map(a=>a._key)).Except(...(subcommandInfo?.childrenToIgnore ?? [])).length) {\n\t\treturn `Cannot delete this node (#${node._key}) until all its children have been unlinked or deleted.`;\n\t}\n\treturn null;\n});\n\nexport const ForCut_GetError = StoreAccessor(s=>(userID: string, node: MapNodeL2)=>{\n\tconst baseText = `Cannot unlink node #${node._key}, since `;\n\tif (!IsUserCreatorOrMod(userID, node)) return `${baseText}you are not its owner. (or a mod)`;\n\t//if (!asPartOfCut && (node.parents || {}).VKeys().length <= 1) return `${baseText}doing so would orphan it. Try deleting it instead.`;\n\tif (IsRootNode(node)) return `${baseText}it's the root-node of a map.`;\n\tif (IsNodeSubnode(node)) return `${baseText}it's a subnode. Try deleting it instead.`;\n\treturn null;\n});\n\nexport const ForCopy_GetError = StoreAccessor(s=>(userID: string, node: MapNode)=>{\n\tif (!CanGetBasicPermissions(userID)) return \"You're not signed in, or lack basic permissions.\";\n\tif (IsRootNode(node)) return \"Cannot copy the root-node of a map.\";\n\tif (IsNodeSubnode(node)) return \"Cannot copy a subnode.\";\n\treturn null;\n});\n\n/* export function GetUnlinkErrorMessage(parent: MapNode, child: MapNode) {\n\t//let childNodes = node.children.Select(a=>nodes[a]);\n\tlet parentNodes = nodes.filter(a=>a.children && a.children[node._id]);\n\tif (parentNodes.length <= 1)\n} */","import {StoreAccessor} from \"mobx-firelink\";\nimport {GetNodeChildrenL2, GetNodeChildren} from \"../subrepos/dm-server/Source/@Shared/Store/firebase/nodes\";\nimport {mainMap_rootNodeID} from \"../pages/Questions\";\nimport {MapNodeL2} from \"../subrepos/dm-server/Source/@Shared/Store/firebase/nodes/@MapNode\";\n\nexport function GetFinalNodeTitle(node: MapNodeL2) {\n\t//if (node == null) return \"\";\n\tlet result = node.current.titles.base;\n\t// in the GAD client/ui, replace \"CC\" with the full \"Climate Change\"\n\tresult = result.replace(/(^|\\W)CC(\\W|$)/g, \"$1Climate Change$2\");\n\treturn result;\n}\n\nexport const GetQuestions = StoreAccessor(s=>()=> {\n\tconst questions = GetNodeChildrenL2(mainMap_rootNodeID);\n  questions.sort((a, b)=>a.createdAt - b.createdAt); // until we have a way to manually specify the order, use node creation-time\n  return questions;\n});\nexport const GetQuestionPositions = StoreAccessor(s=>(questionID: string)=> {\n\treturn GetNodeChildrenL2(questionID);\n});\nexport const GetPositionReasons = StoreAccessor(s=>(positionID: string)=> {\n\treturn GetNodeChildrenL2(positionID);\n});","import * as React from 'react'\nimport { Link } from 'react-router-dom'\nimport { observer } from \"mobx-react\";\n\nimport { PageEffects } from '../components/PageEffects'\nimport { ExploreScore } from '../components/ExploreScore'\nimport '../styles/Questions.scss'\nimport { TitleBlock } from '../components/TitleBlock'\nimport { GetNodeChildren, GetNode, GetNodeChildrenL2 } from \"../subrepos/dm-server/Source/@Shared/Store/firebase/nodes\";\nimport {GetQuestions, GetQuestionPositions, GetFinalNodeTitle} from '../firestore/firestore';\n\n// uuid of the root Climate Change debate map, and its root node\nexport const mainMapID = \"DjedFbxfS2-ImEsHDiZNiA\";\nexport const mainMap_rootNodeID = \"v3RJAZH0Tr-nUjjvKd_39g\";\n\nexport const Questions = observer((props) => {\n  /*const questions = [\n    { title: 'What is climate change?', positions: 6 },\n    { title: 'What causes it?', positions: 6 },\n    { title: 'Is it happening?', positions: 14 },\n    { title: 'Is it a threat?', positions: 22 },\n    { title: 'What could or should be done?', positions: 9 },\n    { title: 'What is climate change?', positions: 6 },\n    { title: 'What causes it?', positions: 6 },\n    { title: 'Is it happening?', positions: 14 },\n    { title: 'Is it a threat?', positions: 22 },\n    { title: 'What could or should be done?', positions: 9 },\n  ]*/\n\n  const questions = GetQuestions();\n  const questionPositions = questions.map(question=>GetQuestionPositions(question._key));\n\n  return (\n    <main className=\"page questions\">\n      <PageEffects duration={200} animation=\"fadeOut\" options=\"once\" />\n      <section className=\"top-container\">\n        <TitleBlock title=\"Select your debate question\" />\n        <ExploreScore exploreScore={38} />\n      </section>\n      <section className=\"bottom-container\">\n        <div className=\"question-list-container paper-background\">\n          <ul className=\"question-list scroll-list\">\n            {questions.map((item, index) => {\n              return (\n                <li key={index}>\n                  <Link to={`/positions/${item._key}`}>\n                    <span className=\"question-number\">{index + 1}</span>\n                    <span className=\"question\">{GetFinalNodeTitle(item)}</span>\n                  </Link>\n                  <div className=\"circle circle-s bezel-xs drop-shadow\">\n                    <p>{questionPositions[index].length}</p>\n                    <p>positions</p>\n                  </div>\n                </li>\n              )\n            })}\n          </ul>\n        </div>\n        <p className=\"tip\">Tip: Start with the first question and work your way through</p>\n      </section>\n    </main>\n  )\n});\n","import React from 'react'\nimport { Link } from 'react-router-dom'\n\nimport { ExploreScore } from './ExploreScore'\n\nimport '../styles/Position.scss'\n\nexport const Position = (props) => {\n  const { title, positionCount, exploreScore, ctaUrl } = props\n\n  return (\n    <div className=\"position\">\n      {positionCount && positionCount > -1 && (\n        <div className=\"position-count circle circle-s bezel-xs drop-shadow\">\n          <p>{positionCount}</p>\n          <p>positions</p>\n        </div>\n      )}\n      {exploreScore !== undefined && exploreScore > -1 && <ExploreScore exploreScore={exploreScore} size=\"s\" />}\n      <div className=\"speech-bubble drop-shadow\">\n        <h3 className=\"position-title text-size-m\">{ctaUrl ? <Link to={ctaUrl}>{title}</Link> : title}</h3>\n        {ctaUrl && (\n          <p>\n            <Link to={ctaUrl}>Explore ></Link>\n          </p>\n        )}\n      </div>\n    </div>\n  )\n}\n","import * as React from 'react'\n\nimport { TitleBlock } from '../components/TitleBlock'\nimport { PageEffects } from '../components/PageEffects'\nimport { Position } from '../components/Position'\n\nimport '../styles/Positions.scss'\nimport {useParams} from 'react-router-dom'\nimport {GetQuestionPositions, GetFinalNodeTitle} from '../firestore/firestore'\nimport {observer} from 'mobx-react'\nimport {GetNodeL2} from '../subrepos/dm-server/Source/@Shared/Store/firebase/nodes/$node'\n\nexport const Positions = observer((props) => {\n  /*const positions = [\n    { title: \"It's uncertain\", positionCount: 6, exploreScore: 1 },\n    { title: 'Impossible to know', positionCount: 6, exploreScore: 33 },\n    { title: 'Yes', positionCount: 14, exploreScore: 100 },\n    { title: 'No', positionCount: 22 },\n    { title: \"It's uncertain\", positionCount: 6, exploreScore: 0 },\n    { title: 'Impossible to know', positionCount: 6, exploreScore: 0 },\n    { title: 'Yes', positionCount: 14 },\n    { title: 'No', positionCount: 22, exploreScore: 0 },\n  ]*/\n  const { id } = useParams();\n  const question = GetNodeL2(id);\n  if (question == null) return null; // still loading\n  const positions = GetQuestionPositions(id);\n  const exploreScore = 0;\n\n  return (\n    <main className=\"page positions\">\n      <PageEffects duration={200} animation=\"fadeOut\" options=\"once\" />\n      <section className=\"top-container bezel-l\">\n        <TitleBlock title={GetFinalNodeTitle(question)} titleSize=\"l\" subtitle=\"Start exploring positions\" />\n      </section>\n      <section className=\"bottom-container scroll-gradient-top scroll-gradient-bottom \">\n        <div className=\"positions-container\">\n          {positions.map((item, index) => {\n            return (\n              <Position\n                key={index}\n                title={GetFinalNodeTitle(item)}\n                positionCount={positions.length}\n                exploreScore={exploreScore > -1 ? exploreScore : 0}\n                ctaUrl={`/reasons/${item._key}`}\n              />\n            )\n          })}\n        </div>\n      </section>\n    </main>\n  )\n});\n","import React from 'react'\nimport { Link } from 'react-router-dom'\n\nimport '../styles/Reason.scss'\n\nexport const Reason = (props) => {\n  const { title, ctaUrl } = props\n\n  return (\n    <div className=\"reason rectangle\">\n      {ctaUrl && <Link to={ctaUrl}>Explore ></Link>}\n      <h3>{title}</h3>\n    </div>\n  )\n}\n","import * as React from 'react'\n\nimport { Position } from '../components/Position'\nimport { Reason } from '../components/Reason'\nimport { TitleBlock } from '../components/TitleBlock'\n\nimport '../styles/Reasons.scss'\nimport {useParams} from 'react-router-dom'\nimport {GetNodeL2} from '../subrepos/dm-server/Source/@Shared/Store/firebase/nodes/$node'\nimport {GetPositionReasons, GetFinalNodeTitle} from '../firestore/firestore'\nimport {observer} from 'mobx-react'\n\nexport const Reasons = observer((props) => {\n  /*let position = { title: 'Yes', positionCount: 14, exploreScore: 100 }\n  let reasons = [\n    { title: 'Evidenced by global temperature changes', ctaUrl: 'reasons' },\n    { title: 'Evidenced by ocean acidification', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster frequency', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster intensity', ctaUrl: 'reasons' },\n    { title: 'Evidenced by global temperature changes', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster frequency', ctaUrl: 'reasons' },\n    { title: 'Evidenced by ocean acidification', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster intensity', ctaUrl: 'reasons' },\n    { title: 'Evidenced by global temperature changes', ctaUrl: 'reasons' },\n    { title: 'Evidenced by ocean acidification', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster frequency', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster intensity', ctaUrl: 'reasons' },\n    { title: 'Evidenced by global temperature changes', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster frequency', ctaUrl: 'reasons' },\n    { title: 'Evidenced by ocean acidification', ctaUrl: 'reasons' },\n    { title: 'Evidenced by increased natural disaster intensity', ctaUrl: 'reasons' },\n  ]*/\n  const { id } = useParams();\n  let position = GetNodeL2(id);\n  if (position == null) return null; // still loading\n  let reasons = GetPositionReasons(id);\n  let exploreScore = 0;\n\n  return (\n    <main className=\"page reasons\">\n      <section className=\"top-container bezel-l\">\n        <Position title={GetFinalNodeTitle(position)} positionCount={reasons.length} exploreScore={exploreScore} />\n        <TitleBlock\n          title={GetFinalNodeTitle(position)}\n          titleSize=\"m\"\n          subtitle=\"Explore the reasons that support this position\"\n          subtitleSize=\"xs\"\n        />\n      </section>\n      <section className=\"scroll-gradient-top scroll-gradient-bottom bottom-container\">\n        <ul className=\"reasons-list scroll-list\">\n          {reasons.map((item, index) => {\n            return (\n              <li key=\"index\">\n                <Reason title={GetFinalNodeTitle(item)} ctaUrl={\"reasons\"} />\n              </li>\n            )\n          })}\n        </ul>\n      </section>\n    </main>\n  )\n});\n","import * as React from 'react'\n\nexport const Argument = (props) => {\n  return null\n}\n","import * as React from 'react'\n\nexport const Claim = (props) => {\n  return null\n}\n","import \"mobx\"; // import mobx before we declare the module below, otherwise vscode auto-importer gets confused at path to mobx\nimport {InitFirelink} from \"./dm-server/Source/@Shared/MobXFirelink\";\nimport firebase from \"firebase\";\n\nconst firebaseConfig = {\n\t\"apiKey\":\"AIzaSyCnvv_m-L08i4b5NmxGF5doSwQ2uJZ8i-0\",\n\t\"authDomain\":\"debate-map-prod.firebaseapp.com\",\n\t\"databaseURL\":\"https://debate-map-prod.firebaseio.com\",\n\t\"projectId\":\"debate-map-prod\",\n\t\"storageBucket\":\"debate-map-prod.appspot.com\",\n};\n\nconst dbVersion = 12;\nconst DB_SHORT = \"prod\";\nconst linkRootPath = `versions/v${dbVersion}-${DB_SHORT}`;\n\n// we aren't currently using mobx for a general app data-store, so just pass an empty object\nconst store = {};\n\nexport function initDebateMapServerLink() {\n\tfirebase.initializeApp(firebaseConfig);\n\tInitFirelink(linkRootPath, store);\n}","import React, { Component } from 'react'\nimport { HashRouter, Switch, Route } from 'react-router-dom'\n\nimport { TopNav } from './components/TopNav'\nimport { Welcome } from './pages/Welcome'\nimport { Debates } from './pages/Debates'\nimport { Questions } from './pages/Questions'\nimport { Positions } from './pages/Positions'\nimport { Reasons } from './pages/Reasons'\nimport { Argument } from './pages/Argument'\nimport { Claim } from './pages/Claim'\n\nimport './styles/App.scss'\nimport {initDebateMapServerLink} from './subrepos/init-dm-server'\n\ninitDebateMapServerLink();\n\nclass App extends Component {\n  render() {\n    return (\n      <HashRouter basename=\"/\">\n        <div className=\"app\">\n          <TopNav />\n          <Route path=\"/questions\" component={Questions} />\n          <Route path=\"/positions/:id\" component={Positions} />\n          <Route path=\"/reasons/:id\" component={Reasons} />\n          <Route path=\"/argument\" component={Argument} />\n          <Route path=\"/claim\" component={Claim} />\n          <Route path=\"/debates\" component={Debates} />\n          <Route exact path=\"/\" component={Welcome} />\n        </div>\n      </HashRouter>\n    )\n  }\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport './styles/index.scss'\n\nReactDOM.render(React.createElement(App), document.getElementById('root'))\n"],"sourceRoot":""}